{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load tz %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<!-- <link rel="stylesheet" href="{% static 'assets/css/style.css' %}"> -->


<style>

#newpayment {
  z-index: 2080; /* Adjust this value as needed to ensure it appears above the customer modal */
}
  .modal{
    z-index: 9999;
    overflow: scroll;
  }
    input[type=text], select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    
    label {
      padding: 12px 12px 12px 0;
      display: inline-block;
    }
    
    
    .row:after {
      content: "";
      display: table;
      clear: both;
    }
    
    @media screen and (max-width: 600px) {
      .col-25, .col-75, input[type=submit] {
        width: 100%;
        margin-top: 0;
      }
      input[type=text], select, textarea {
      width: 100%;

    }
    }

    .dropdown input,
    .dropdown button {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
    }

    .dropdown.open input,
    .dropdown.open button {
      display: block;
    }

    .row a{
      color: rgb(218, 164, 48);
      font-size: 12px;
    }

    .table th a{
      color:rgb(218, 164, 48);
      font-size: 11px;
      margin-left: 100px;
    }


    ::-webkit-scrollbar {
      width: 5px; 
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1; 
    }

    ::-webkit-scrollbar-thumb {
      background: #888; 
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555; 
    }
    .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }
 
   

    </style>


<div class="container-fulid containerprof">

  <div class="card radius-15" style="width: 100%;">
    <div class="card-body">
        <div class="card-title">
          <h2 class="mb-0 text-uppercase text-right"> New Credit Note</h2>
        </div>
    </div>
  </div>
  <div>
  <div class="card radius-15 p-5">
    <form action="{% url 'editdb' pk=creditnote.pk %}" class="mt-2 mb-4" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-3">
          <label >Customer Name *</label>
        </div>
        <div class="col-md-6">
            <select name="cx_name" id="customer_sel" class="form-control bg-light text-dark">
                <option value="{{ creditnote.customer.customer_id }}">
                    {{ creditnote.customer.customerName }}
                </option>
                {% for cust in cust %}
                <option value="{{cust.id}}" data-email="{{ cust.customerEmail }}" data-gst="{{ cust.GSTTreatment }}" data-gstin="{{cust.GSTIN}}" data-pos="{{cust.placeofsupply}}" data-billing_address="{{ cust.Address1 }} ,{{cust.state}}"
                >{{cust.customerName}}</option>
                {% endfor %}
            </select>
          <a href="" data-toggle="modal" data-target="#newcustomer">+ Add New Customer</a>
        </div>
      </div>
      <div class="row mt-2" id="email_row" >
        <div class="col-md-3">
          <label for="email">Email</label>
        </div>
        <div class="col-md-6">
          <input type="text" value="{{ creditnote.customer.customerEmail }}" class="form-control bg-light text-dark" id="email_input" name="email">
        </div>
      </div>
      
      <div class="row mt-2" id="pos_row" >
        <div class="col-md-3">
          <label for="pos">Place of Supply</label>
        </div>
        <div class="col-md-6">
            <div>
            <input type="text" value="{{ creditnote.customer.placeofsupply }}" class="form-control bg-light text-dark" id="pos_input" name="place_of_supply" disabled>
          </div>
        </div>
        
      </div>
      
      
      <div class="row mt-2" id="gst_row" >
        <div class="col-md-3">
          <label for="gst">GST Treatment</label>
        </div>
        <div class="col-md-6">
          <input type="text" value="{{ creditnote.customer.GSTTreatment }}" class="form-control bg-light text-dark" id="gst_input" name="gst_treatment">
        </div>
      </div>

      <div class="row mt-2" id="gstin_row" {% if not creditnote.customer.GSTIN %}style="display: none;"{% endif %}>
        <div class="col-md-3">
            <label for="gst">GSTIN</label>
        </div>
        <div class="col-md-6">
            <input type="text" value="{{ creditnote.customer.GSTIN }}" class="form-control bg-light text-dark" id="gstin_input" name="gstin">
        </div>
    </div>
      
      <div class="row mt-2" id="billing_address_row" >
        <div class="col-md-3">
          <label for="billing_address">Billing Address</label>
        </div>
        <div class="col-md-6">
          <input type="text" value="{{ creditnote.customer.Address1 }},{{ creditnote.customer.state }}" class="form-control bg-light text-dark" id="billing_address_input" name="billing_address" rows="2"   disabled>
        </div>
      </div>
      
      <div class="row mt-2">
        <div class="col-md-3">
            <label for="prof_name">Invoice Number</label>
        </div>

        <div class="col-md-6">
            <input type="text" value="{{ creditnote.invoice_number }}"
                class="form-control bg-light text-dark" id="prof_name" name="sale_no">
        </div>
    </div>


    <div class="row mt-2">
        <div class="col-md-3">
            <label>Credit Note*</label>
        </div>
        <div class="col-md-6">
            <input type="text" value="{{ creditnote.credit_note }}"
                class="form-control bg-light text-dark" id="credit_note" name="credit_note">
        </div>
    </div>

  
    <div class="row mt-2">
        <div class="col-md-3">
            <label for="prof_name">Reference</label>
        </div>

        <div class="col-md-6">
            <input type="text" value="{{ creditnote.reference }}"
                class="form-control bg-light text-dark" id="ref" name="ord_no">
        </div>
    </div>

    <div class="row mt-2">
        <div class="col-md-3">
            <label for="date1">Creditnote Date</label>
        </div>
        <div class="col-md-6">
            <input type="date" value="{{ creditnote.creditnote_date|date:'Y-m-d' }}"
                class="form-control bg-light text-dark" id="date1" name="cr_date">
        </div>
    </div>
      <!-------------------------- new-----------------------------------------  -->
      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
    $(document).ready(function () {
        // Change event listener for the customer dropdown
        $('#customer_sel').change(function () {
            var selectedCustomer = $('#customer_sel option:selected');
            var email = selectedCustomer.data('email');
            var placeOfSupply = selectedCustomer.data('pos');
            var gstTreatment = selectedCustomer.data('gst');
            var gstin = selectedCustomer.data('gstin'); // Get the GSTIN from the data attribute
            var billingAddress = selectedCustomer.data('billing_address');

            // Content of the placeholders
            $('#email_input').val(email);
            $('#pos_input').val(placeOfSupply);
            $('#gst_input').val(gstTreatment);
            $('#gstin_input').val(gstin); // Set the value of the GSTIN input field
            $('#billing_address_input').val(billingAddress);

            // Show or hide fields based on selection
            if (selectedCustomer.val() !== '') {
                $('#email_row').show();
                $('#pos_row').show();
                $('#gst_row').show();

                // Conditionally show/hide the GSTIN row based on GST treatment
                if (
                    gstTreatment.toLowerCase() === "unregistered business-not registered under gst" ||
                    gstTreatment.toLowerCase() === "overseas- persons with who you do import or exports of supplies outside india"
                ) {
                    $('#gstin_row').hide(); // Hide the GSTIN row
                } else {
                    $('#gstin_row').show(); // Show the GSTIN row
                }

                $('#billing_address_row').show();
            } else {
                $('#email_row').hide();
                $('#pos_row').hide();
                $('#gst_row').hide();
                $('#gstin_row').hide(); // Hide the GSTIN row
                $('#billing_address_row').hide();
            }
        });
    });
</script>

      
        
      </div> 
      <div class="row mt-2">
        <div class="col-md-12 table-responsive-md mt-3">
            <table class="table table-bordered" id="item_table" onclick='toggleDateInput()'>
                <thead>
                    <tr>
                        <th>Item<br><a href="" data-toggle="modal" data-target="#newitem"
                                class="text-capitalize">+ Item</a></th>
                        <th class="text-right">HSN</th>
                        <th class="text-right">Quantity</th>
                        <th class="text-right">Rate</th>
                        <th class="text-right">Tax</th>
                        <th class="text-right">Discount</th>
                        <th class="text-right">Amount</th>
                        <th colspan="2"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for creditnote in credititems %}
                    <tr id="row1">
                        <td style="width: 10%;">
                            <div> <select class='form-control bg-light text-dark border-0 item_select itm'
                                    name='item_name[]'>
                                    <option value="" disabled>Select Item</option>
                                    {% for i in itm %}
                                    <option value="{{ i.Name }}"
                                        {% if i.Name == credititem.item_name %} selected {% endif %}>
                                        {{ i.Name }}</option>
                                    {% endfor %}
                                </select></div>
                        </td>
          
             
                        <td style="width: 13%;" class='text-right'><input type='number' id='hsn1'
                            class=' text-right qty form-control bg-light text-dark' name='hsn'
                            value="{{ creditnote.hsn }}">
                    </td>
                    <td style="width: 15%;" class='text-right'><input type='number' id='qty1'
                            class=' text-right rate form-control bg-light text-dark' name='quantity[]'
                            value="{{creditnote.quantity}}">
                    </td>
                    <td style="width: 12%;" class='text-right text-dark'><input type='number' id='rate1'
                            class=' text-right discount bg-light text-dark form-control' name='rate[]'
                            value='{{creditnote.rate}}'>
                    </td>
                    <td style="width: 15%;" class='text-right '> 
                        <select name='tax[]' class='form-control bg-light text-dark  text-right border-0 tax'>
                            {% if creditnote.customer.placeofsupply == "[KL] Kerala" %}
                            <option class="text-dark">{{creditnote.tax}}%GST</option>
                            <option value="0" class="text-dark">0% GST</option>
                            <option value="3" class="text-dark">3% GST</option>
                            <option value="5" class="text-dark">5% GST</option>
                            <option value="12" class="text-dark">12% GST</option>
                            <option value="18" class="text-dark">18% GST</option>
                            <option value="28" class="text-dark">28% GST</option>
                            {% else %}
                            <option class="text-dark">{{creditnote.tax}}%IGST</option>
                            <option value="0" class="text-dark">0% IGST</option>
                            <option value="3" class="text-dark">3% IGST</option>
                            <option value="5" class="text-dark">5% IGST</option>
                            <option value="12" class="text-dark">12% IGST</option>
                            <option value="18" class="text-dark">18% IGST</option>
                            <option value="28" class="text-dark">28% IGST</option>   
                            {% endif %}              
                        </select>
                    </td>
                    
                    
                    <td style="width: 15%;" class='text-right'><input type='number' id='discount'
                            class=' text-right form-control amount bg-light text-dark' name='discount[]'
                            value='{{creditnote.discount}}'></td>
                    <td style="width: 15%;" class='text-right'><input type='number' id='amount1'
                            class=' text-right form-control amount bg-light text-dark' name='amount[]'
                            value='{{creditnote.amount}}'></td>
                    <td class='text-center'><button type='button' id='del_btn1'
                            class='btn btn-transparent text-danger btn-sm btn-outline-danger rounded-circle delete-row'
                            style='width:30px'>X</button></td>
                    <td class='text-center'>
                        <button type='button'
                            class='btn btn-transparent text-primary btn-sm btn-outline-primary rounded-circle clone-row'
                            data-row=1 style='width:30px'><i class="fa fa-clone"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
<script>
  /////////////////////////////////Remove/////////////////////////////////////////////
$(document).ready(function () {
  // Add event listener for the "X" button clicks
  $('#item_table').on('click', '.delete-row', function () {
    $(this).closest('tr').remove(); // Remove the closest <tr> (row) to the clicked button
  });
});
</script>

<script>
  ////////////////////////////clone/////////////////////////////////////
  $(document).ready(function () {
    // Add event listener for the "Clone" button clicks
    $('#item_table').on('click', '.clone-row', function () {
      var rowToClone = $(this).closest('tr'); // Find the closest <tr> (row) to clone
      var newRow = rowToClone.clone(); // Clone the row
      
      // Clear any unique identifiers or values in the cloned row
      newRow.find('input[type="text"]').val('');
      newRow.find('input[type="number"]').val('0');
      
      // Clone the item name field, including its selected option
      var originalItemField = rowToClone.find('select[name="item_name[]"]');
      var clonedItemField = newRow.find('select[name="item_name[]"]');
      clonedItemField.val(originalItemField.val());
      
      // Clone the HSN, quantity, rate, discount, and amount fields
      var originalHSNField = rowToClone.find('input[name="hsn"]');
      var clonedHSNField = newRow.find('input[name="hsn"]');
      clonedHSNField.val(originalHSNField.val());
      
      var originalQtyField = rowToClone.find('input[name="quantity[]"]');
      var clonedQtyField = newRow.find('input[name="quantity[]"]');
      clonedQtyField.val(originalQtyField.val());
      
      var originalRateField = rowToClone.find('input[name="rate[]"]');
      var clonedRateField = newRow.find('input[name="rate[]"]');
      clonedRateField.val(originalRateField.val());
      
      var originalDiscountField = rowToClone.find('input[name="discount[]"]');
      var clonedDiscountField = newRow.find('input[name="discount[]"]');
      clonedDiscountField.val(originalDiscountField.val());
      
      var originalAmountField = rowToClone.find('input[name="amount[]"]');
      var clonedAmountField = newRow.find('input[name="amount[]"]');
      clonedAmountField.val(originalAmountField.val());
      
      // Clone the tax field, including its selected option
      var originalTaxField = rowToClone.find('select[name="tax[]"]');
      var clonedTaxField = newRow.find('select[name="tax[]"]');
      clonedTaxField.val(originalTaxField.val());
      
      // Append the cloned row to the table
      $('#item_table tbody').append(newRow);
    });
  });
  </script>
  
  <button type="button" class="btn btn-sm text-white" style="background-color: rgb(210, 132, 30);" id="add-row-button">Add another line</button>
  

  <div class="row border-bottom pb-5">
    <div class="col-sm-5 d-flex flex-column mt-auto">
        <label for="">Customer Notes</label>
        <textarea name="customer_note" id="" cols="8" rows="8"
            placeholder=" Will be Displayed on the Purchase Order">{{ creditnote.customer_notes }}</textarea>
    </div>
    <div class="col-sm-6 mt-4">
        <table class=" table  text-white" style="background-color: rgba(58, 57, 57, 0.8);">
            <tr>
                <td>Sub Total</td>
                <td></td>
                <td><input type="number" id="subtotal" name="subtotal" step="any"
                        class="bg-transparent border-0 text-right subtotal text-white"
                        value="{{ creditnote.subtotal }}"></td>
            </tr>
            <tr id="tr_igst" {% if creditnote.igst == 0 %}style="display: none;"{% endif %}>
                <td>IGST</td>
                <td></td>
                <td><input type="number" id="igst" name="igst" step="any"
                        value="{{ creditnote.igst }}"
                        class="form-control bg-transparent border-0 text-right igst text-white"></td>
            </tr>            
            <tr id="tr_cgst" {% if creditnote.cgst == 0 %}style="display: none;"{% endif %}>
                <td>CGST</td>
                <td></td>
                <td><input type="number" value="{{ creditnote.cgst }}" id="cgst" name="cgst"
                        step="any" 
                        class="form-control bg-transparent border-0 text-right cgst text-white">
                </td>
            </tr>
            <tr id="tr_sgst" {% if creditnote.sgst == 0 %}style="display: none;"{% endif %}>
                <td>SGST</td>
                <td></td>
                <td><input value="{{ creditnote.sgst }}" type="number" id="sgst" name="sgst"
                        step="any" 
                        class="form-control bg-transparent border-0 text-right sgst text-white">
                </td>
            </tr>
            <tr>
                <td>Tax Total</td>
                <td></td>
                <td><input type="number" id="tax_total" name="tax_total" step="any"
                        value="{{ creditnote.total_tax }}"
                        class="form-control bg-transparent border-0 text-right tax_total text-white">
                </td>
            </tr>
            <tr>
                <td>Shipping Charges</td>
                <td><input type="hidden" id="shipping_charge" step="any"
                        value="{{ creditnote.shipping_charge }}"
                        class="form-control bg-transparent border-0 text-right shipping_charge  ">
                </td>
                <td><input type="number" class="form-control  bg-transparent border-0  text-light"
                        id="shipping" value="{{ creditnote.shipping_charge }}"
                        name="shipping_charge"> </td>
            </tr>
            <tr>
                <td>Adjustment</td>
                <td></td>
                <td><input type="number" id="adjustment" name="adjustment" step="any"
                        value="{{ creditnote.adjustment }}"
                        class="form-control bg-transparent border-0 text-right adjustment"></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td> </td>
            </tr>
            <tr>
                <th>Total ( &#x20B9; )</th>
                <th></th>
                <th><input type="number" id="grandtotal" name="t_total" step="any"
                        value="{{ creditnote.total }}"
                        class="form-control bg-transparent border-0 text-right grandtotal  text-white">
                </th>
            </tr>
        </table>
    </div>
</div>

<div class="row py-5 border-bottom">
    <div class="col-md-8 d-flex flex-column w-60 text-white">
        <label for="">Terms & Conditions</label>
        <textarea name="ter_cond" id="" cols="20" rows="5"
            placeholder=" Enter the terms & conditions of your business to be displayed in your transaction.">{{ creditnote.terms_and_conditions }}</textarea>
    </div>
    <div class="col-md-4 py-5 text-center rounded" style="background-color: rgba(32, 35, 37);">
        <label class="text-white" for="">Attach File(s) to Purchase</label><br>

        <input id="file-upload" class="form-control bg-light text-dark" type="file" name="file">
    </div>
</div>
<div class="row mt-5 mb-3 m-5 ">
    <input style="width: 150px;margin-right: 2rem;" type="submit" class="btn btn-success mt-2"
        value="Save">
        <a href="" class="btn btn-danger mt-2" style="width: 150px;">Cancel</a>

</div>
</form>
</div>
</div>
</div>
<!---------------------------- add another line -------------------------- -->
    <script>
      $(document).ready(function () {
        // Function to calculate and update the total for a row
        function calculateRowTotal(row) {
          var quantity = parseFloat(row.find('input[name="quantity[]"]').val());
          var rate = parseFloat(row.find('input[name="rate[]"]').val());
          var discount = parseFloat(row.find('input[name="discount[]"]').val());
          
          var total = quantity * rate;
          if (!isNaN(discount)) {
            total -= discount;
          }
          
          row.find('input[name="amount[]"]').val(total.toFixed(2));
        }
        
        // Add event listener for changes in quantity, rate, and discount fields
        $('#item_table tbody').on('change', 'input[name="quantity[]"], input[name="rate[]"], input[name="discount[]"]', function () {
          var row = $(this).closest('tr');
          calculateRowTotal(row);
        });
        
       
          
          // Clear the tax amount field in the cloned row
          newRow.find('input[name="taxamount"]').val('');
          
          // Append the cloned row to the table
          $('#item_table tbody').append(newRow);
        });
      </script>
      








   
    <!-- payment modal -->



    <div class="modal fade" id="newpayment">
      <div class="modal-dialog">
        <div class="modal-content">
          <h6 style="color: red;">Payment Terms</h6>
          <!-- Rest of your modal content here -->
          <form id="modalForm"  action="" onsubmit="return false">
            <div id="terms-container">
              <div class="form-row">
                {% for p in pay %}
                <div class="col-6">
                    <input type="text" value="{{p.Terms}}" class="form-control text-black" placeholder="Terms">
                  </div>
                  <div class="col-6">
                    <input type="text" value="{{p.Days}}" class="form-control text-black" placeholder="No of Days">
                  </div>
                {% endfor %}
    
                <div class="col-6">
                  <input type="text" name="terms" class="form-control text-black" placeholder="Terms">
                </div>
                <div class="col-5">
                  <input type="text" name="days" class="form-control text-black" placeholder="No of Days">
                </div>
                <div class="col-1 ">
                  <button type="button" class="btn btn-success add-term-row">+</button>
                </div>
              </div>
            </div>
            <div class="form-row mt-3">
              <div class="col-12 text-right">
                <input type="submit" class="btn btn-success" value="submit" id="payment">
              </div>
            </div>
         </form>



        </div>
      </div>
    </div>
    
    <!-- customer modal -->
          
          
    <div class="modal fade" id="newcustomer">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Customer</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalCustomer">
        
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="">Customer Type</label><br>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="business" name="radioCust" value="Business" >
                        <label for="option1">Business</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="individual" name="radioCust" value="Individual" >
                        <label for="option2">Individual</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-3">
                    <label for="ctitle">Title</label>
                  </div>
                  <div class="col-md-3">
                    <select name="ctitle" id="ctitle" class="form-control bg-light text-dark">
                      <option value="Mr." selected>Mr.</option>
                      <option value="Mrs.">Mrs.</option>
                      <option value="Ms.">Ms.</option>
                      <option value="Miss.">Miss.</option>
                      <option value="Dr.">Dr.</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cfname">First name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="cfname" name="cfirstname" required>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="clname">Last name</label>
                    <label id="cdisplayname" name = "cdisplayname" hidden></label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="clname" name="clastname">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="ccompany">Company Name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="ccompany" name="ccompany_name">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cemail">Customer Email</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="email" class="form-control bg-light text-dark" id="cemail" name="cemail" placeholder="example@gmail.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$">    
                  </div>              
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="email">Customer Phone</label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="cw_mobile" placeholder="Work Number" maxlength="10" name="cw_mobile">
                  </div>        
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="cp_mobile" placeholder="Personal Number" maxlength="10" name="cp_mobile">
                  </div>          
                </div>

           
                <hr>
                <center><h4 class="text-uppercase mb-3"><b>Other Details</b></h4></center>
                <div class="row mt-5">
                  <div class="col-md-3 mt-2">
                    <label for="facebook">Facebook</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="facebook" placeholder="www.example.com" name="facebook">
                  </div>       
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="twitter">Twitter</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="twitter" placeholder="www.example.com" name="twitter">
                  </div>       
                </div>


                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="website">Website</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="website" placeholder="www.example.com" name="website">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cskype">Skype name/Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="cskype" name="cskype">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_desg">Designation</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="c_desg" name="c_desg" >
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_dpt">Department</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="c_dpt" name="c_dpt">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_gsttype" style="color:rgb(190, 88, 88);">GST Treatment *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control bg-light text-dark" id="c_gsttype" name="c_gsttype" required>
                      <option value="value" selected>Select a Gst Treatment</option>
                      <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                      <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">Registered Business-Composition Business that is registered under the Composition scheme in GST</option>
                      <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                      <option value="Consumer- A customer who is a regular Consumer">Consumer- A customer who is a regular Consumer</option>
                      <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                      <option value="Special Economic Zone">Special Economic Zone</option>
                    </select>
                  </div>       
                </div>

                <div class="row gstrow d-none">
                  <div class="col-md-3 mt-2">
                    <label id="glbl" style="color:rgb(190, 88, 88);">GSTIN/UIN *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark" id="c_gstin" name="c_gstin" placeholder="29APPCK7465F1Z1">
                    <label id="gst_label"></label>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="c_pan">PAN Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark" id="c_pan" name="c_pan" placeholder="APPCK7465F">
                    <label id="pan_label"></label>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="" style="color: rgb(190, 88, 88);">Place of Supply *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control bg-light text-dark" id="placesupply" name="placesupply">
                      <option value="Nill"></option>
                      <option value="[AN] Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                      <option value="[AD] Andhra Predhesh">[AD] Andhra Predhesh</option>
                      <option value="[AR] Arunachal Predesh">[AR] Arunachal Predesh</option>
                      <option value="[AS] Assam">[AS] Assam</option>
                      <option value="[BR] Bihar">[BR] Bihar</option>
                      <option value="[CH] Chandigarh">[CH] Chandigarh</option>
                      <option value="[CG] Chhattisgarh">[CG] Chhattisgarh</option>
                      <option value="[DNH] Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                      <option value="[DD] Damn anad Diu">[DD] Damn anad Diu</option>
                      <option value="[DL] Delhi">[DL] Delhi</option>
                      <option value="[GA] Goa">[GA] Goa</option>
                      <option value="[GJ] Gujarat">[GJ] Gujarat</option>
                      <option value="[HR] Haryana">[HR] Haryana</option>
                      <option value="[HP] Himachal Predesh">[HP] Himachal Predesh</option>
                      <option value="[JK] Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                      <option value="[JH] Jharkhand">[JH] Jharkhand</option>
                      <option value="[KA] Karnataka">[KA] Karnataka</option>
                      <option value="[KL] Kerala">[KL] Kerala</option>
                      <option value="[LA] Ladakh">[LA] Ladakh</option>
                      <option value="[LD] Lakshadweep">[LD] Lakshadweep</option>
                      <option value="[MP] Madhya Predesh">[MP] Madhya Predesh</option>
                      <option value="[MH] Maharashtra">[MH] Maharashtra</option>
                      <option value="[MN] Manipur">[MN] Manipur</option>
                      <option value="[ML] Meghalaya">[ML] Meghalaya</option>
                      <option value="[MZ] Mizoram">[MZ] Mizoram</option>
                      <option value="[NL] Nagaland">[NL] Nagaland</option>
                      <option value="[OD] Odisha">[OD] Odisha</option>
                      <option value="[PY] Puducherry">[PY] Puducherry</option>
                      <option value="[PB] Punjab">[PB] Punjab</option>
                      <option value="[RJ] Rajasthan">[RJ] Rajasthan</option>
                      <option value="[SK] Sikkim">[SK] Sikkim</option>
                      <option value="[TN] Tamil Nadu">[TN] Tamil Nadu</option>
                      <option value="[TS] Telangana">[TS] Telangana</option>
                      <option value="[TR] Tripura">[TR] Tripura</option>
                      <option value="[UP] Uttar Predesh">[UP] Uttar Predesh</option>
                      <option value="[UK] Uttarakhand">[UK] Uttarakhand</option>
                      <option value="[WB] West Bengal">[WB] West Bengal</option>
                      <option value="[OT] Other Territory">[OT] Other Territory</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-4 ">
                    <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference * </label>
                  </div>
                  <div class="col-md-5">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="item-tax3" name="radioOption2" value="Taxable" >
                        <label for="option3">Taxable</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="item-tax4" name="radioOption2" value="Tax-exempt" >
                        <label for="option4">Tax-exempt</label>
                      </div>
                    </div>
                  </div>       
                </div>

                <div class="row mt-2 mb-4 d-none inter-intra" >
                  <div class="col-md-3">
                    <label for="intra">Intra-State TAX</label>
                  </div>
                  <div class="col-md-3">
                    <select name="intra" class="form-control bg-light text-dark" id="intra1">
                      <option value="">Select GST</option>

                      <option value="GST0[0%]">GST0[0%]</option>
                      <option value="GST5[5%]">GST5[5%]</option>
                      <option value="GST12[12%]">GST12[12%]</option>
                      <option value="GST18[18%]">GST18[18%]</option>
                      <option value="GST28[28%]">GST28[28%]</option>
                    </select>             
                  </div>

                  
                  <div class="col-md-2">
                    <label for="inter">Inter-State TAX</label>
                  </div>
                  <div class="col-md-3">
                    <select name="inter" class="form-control bg-light text-dark" id="inter1">
                      <option value="">Select GST</option>

                      <option value="IGST0[0%]">IGST0[0%]</option>
                      <option value="IGST5[5%]">IGST5[5%]</option>
                      <option value="IGST12[12%]">IGST12[12%]</option>
                      <option value="IGST18[18%]">IGST18[18%]]</option>
                      <option value="IGST28[28%]">IGST28[28%]</option>
                    </select>               
                  </div>
                  <div class="col-md-1"></div>

                </div>
                
                <hr>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_curn">Currency </label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <select class="form-control bg-light text-dark"id="c_curn" name="c_curn" required>
                      <option selected disabled value="">Choose..</option>
                      <option value="INR">INR</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_open">Opening Balance</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="c_open" name="c_open">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_terms">Payment Terms</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <select class="form-control text-dark bg-light" id="c_terms" name="c_terms" required>
                        <option selected value="15">NET 15</option>
                        <option value="30">NET 30</option>
                        <option value="45">NET 45</option>
                        <option value="60">NET 60</option>
                        <option value="90">NET 90</option>
                        <option value="">Due end of the month</option>
                        <option value="recpt">Due on receipt</option>
                        {% for p in payments %}
                        <option value="{{p.Terms}} {{p.id}}">{{p.Terms}}</option>
                        {% endfor %}
                      </select>                
                      <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal">+</a>   
                    </div>
                  </div>          
                </div>
                

                <hr>

                <div class="row">
                  <div class="col-md-6 mt-5 text-center text-uppercase">
                    <h4 class="mb-0">Billing Address</h4>
                  </div>
                  <div class="col-md-6 mt-5">
                    <h4 class="mb-0 text-center text-uppercase">Shipping Address</h4>
                  </div>
                </div>
                <div class="row mt-2 m-0 p-0 mb-2">
                  <div class="col-md-9"> </div>
                  <div class="col-md-3 text-right  m-0 p-0">
                    <input type="checkbox" onclick="address()" id="voka" name="vokay">
                    <label for="voka" style="color: #909091;">Same As Billing Address</label>
                  </div>
                </div>

                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="cstreet">Address</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control bg-light text-dark street" id="cstreet" name="vstreet"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csstreet">Address</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control bg-light text-dark street" id="csstreet" name="vsstreet"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="ccity" name="vcity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                  <div class="col-md-1">
                    <label for="cscity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cscity" name="cscity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="cstate">State</label>
                  </div>
                  <div class="col-md-4">
                    <select type="text" class="form-control bg-light text-dark" id="cstate" name="vstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>
                  <div class="col-md-1"></div>
  
                  <div class="col-md-1">
                    <label for="csstate">State</label>
                  </div>
                  <div class="col-md-4 ">
                    <select type="text" class="form-control bg-light text-dark" id="csstate" name="vsstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>

                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccountry">Country</label>
                  </div>
                  <div class="col-md-4 ">
                    <input type="text" class="form-control bg-light text-dark" id="ccountry" name="vcountry" placeholder="Country">  
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cscountry">Country</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cscountry"  name="vscountry" placeholder="Country">
                  </div>
                  <div class="col-md-1 "></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cpincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cpincode" name="vpincode" maxlength="6" placeholder="PIN Code"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cspincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cspincode" name="vspincode" maxlength="6"  placeholder="PIN Code">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cphone" name="vphone"  placeholder="Phone"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="csphone" name="vsphone"  placeholder="Phone">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="cfax" name="vfax"  placeholder="FAX"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control bg-light text-dark" id="csfax" name="vsfax"  placeholder="FAX">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                    <div class="col-md-6">
                      <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                      <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                      <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                    </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="customersave"  >Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
                  </div>
              </div>
          </div>
      </div>  
    </div>  
    
   <!-- item modal -->
          
   <div class="modal fade" id="newitem" >
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header " style="background: rgb(32, 35, 37);">
            <h3 class="m-3 text-uppercase">New Item</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3">
            <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalItem">

              <div class="row mt-2">
                <div class="col-md-4 mr-0">
                  <label class="col-form-label col-sm-2 p-0">Type <i class="fa fa-question-circle"></i></label>
                </div>
                <div class="col-md-5 ml-0 d-flex">
                  <div class="radio_opt mx-5 ">
                    <input type="radio" id="item_type1" name="radioOption" value="Goods" >
                    <label for="option1">Goods</label>
                  </div>
                  <div class="radio_opt mx-5 ">
                    <input type="radio" id="item_type2" name="radioOption" value="Services" >
                    <label for="option2">Services</label>
                  </div>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-md-3">
                  <label for="name" style="color: rgb(190, 88, 88);">Name *</label>
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control bg-light text-dark" id="item_name" name="item_name" required>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-md-3 ">
                  <label for="units">Unit</label>
                </div>
                <div class="col-md-6">
                  <div class="d-flex">
                    <select class="form-control bg-light text-dark" id="item_units" name="item_units" required>
                      <option value="">Select Unit</option>
                      {% for u in units %}
                      <option value="{{u.id}}">{{u.unit}}</option>
                      {% endfor %}
                    </select>                
                    <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newunit" data-toggle="modal">+</a>  
                  </div>
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-md-4 ">
                  <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference * </label>
                </div>
                <div class="col-md-5">
                  <div class="d-flex">
                    <div class="radio_opt mx-5 mt-2">
                      <input type="radio" id="item-tax1" name="radioOption1" value="Taxable" >
                      <label for="option1">Taxable</label>
                    </div>
                    <div class="radio_opt mx-4 mt-2">
                      <input type="radio" id="item-tax2" name="radioOption1" value="Tax-exempt" >
                      <label for="option2">Tax-exempt</label>
                    </div>
                  </div>
                </div>       
              </div>

              <div class="row mt-2 mb-4 d-none inter-intra" >
                <div class="col-md-3">
                  <label for="intra">Intra-State TAX</label>
                </div>
                <div class="col-md-3">
                  <select name="intra" class="form-control bg-light text-dark" id="intra">
                    <option value="">Select GST</option>

                    <option value="GST0[0%]">GST0[0%]</option>
                    <option value="GST5[5%]">GST5[5%]</option>
                    <option value="GST12[12%]">GST12[12%]</option>
                    <option value="GST18[18%]">GST18[18%]</option>
                    <option value="GST28[28%]">GST28[28%]</option>
                  </select>             
                </div>

                
                <div class="col-md-2">
                  <label for="inter">Inter-State TAX</label>
                </div>
                <div class="col-md-3">
                  <select name="inter" class="form-control bg-light text-dark" id="inter">
                    <option value="">Select GST</option>

                    <option value="IGST0[0%]">IGST0[0%]</option>
                    <option value="IGST5[5%]">IGST5[5%]</option>
                    <option value="IGST12[12%]">IGST12[12%]</option>
                    <option value="IGST18[18%]">IGST18[18%]]</option>
                    <option value="IGST28[28%]">IGST28[28%]</option>
                  </select>               
                </div>
                <div class="col-md-1"></div>

              </div>
              
              <div class="row mt-2">
                <div class="col-md-3">
                    <label for="hsn">HSN</label>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control bg-light text-dark" id="item_hsn" name="item_hsn">
                </div>
            </div>

              
              <hr>

              <div class="row mt-5 text-center">
                <div class="col-md-6 d-flex text-center">
                  <input  type="checkbox" name="selling" checked class="mx-2 my-0">
                  <h6 class="m-0">Selling Information</h6>
                </div>
                <div class="col-md-6 d-flex text-center">
                  <input  type="checkbox" name="purchase" checked class="mx-2 my-0">
                  <h6 class="m-0">Purchase Information</h6>
                </div>
              </div>
              
              <div class="row mt-4">
                <div class="col-md-2">
                  <label for="sell_price">Selling Price *</label>
                </div>
                <div class="col-md-4">
                  <div class="input-group mb-2">
                    <div class="input-group-prepend">
                      <div class="input-group-text">INR</div>
                    </div>
                    <input required type="text" class="form-control bg-light text-dark" name="sell_price" id="sell_price">
                  </div>                  
                </div>

                <div class="col-md-2">
                  <label for="cost_price">Cost Price *</label>
                </div>
                <div class="col-md-4 ">
                  <div class="input-group mb-2">
                    <div class="input-group-prepend">
                      <div class="input-group-text">INR</div>
                    </div>
                    <input required type="text" class="form-control bg-light text-dark" name="cost_price" id="cost_price">
                  </div>
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-md-2">
                  <label for="vcity">Account</label>
                </div>
                <div class="col-md-4">
                  <select name="sell_acc" id="sell_acc" class="form-control bg-light text-dark">
                    <option value="">Select Account</option>
     
                      <option value="" disabled class="btn btn-dark text-white"><b>SALES</b></option>
                      {% for s in sales %}
                          <option value="{{s.id}}">{{ s.Account_name }}</option>
                    {% endfor %}
                  </select> 
                </div>
                <div class="col-md-2">
                  <label for="cost_acc">Account</label>
                </div>
                <div class="col-md-4">
                  <select name="cost_acc" class="form-control bg-light text-dark" id="cost_acc">
                    <option value="">Select Account</option>
                    
                      <option value="" disabled class="btn btn-dark text-white"><b>PURCHASE</b></option>
                      {% for p in purchase %}
                          <option value="{{p.id}}">{{ p.Account_name }}</option>
                    {% endfor %}

                  </select> 
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-md-2">
                  <label for="sell_desc">Description</label>
                </div>
                <div class="col-md-4">
                  <input  type="text" name="sell_desc" class="form-control bg-light text-dark"  id="sell_desc">
                </div>

                <div class="col-md-2">
                  <label for="cost_desc">Description</label>
                </div>
                <div class="col-md-4 ">
                  <input  type="text" name="cost_desc" class="form-control bg-light text-dark"  id="cost_desc">
                </div>

              </div>

              <div class="row mt-3">
                  <div class="col-md-6">
                    <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                    <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                    <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                  </div>
              </div>
              <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                  <div class="d-flex">
                    <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                    type="submit" data-dismiss="modal" id="itemSave">Submit
                    </button> 

                    <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                      data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Cancel</span>
                    </button>
                  </div>
                </div>
                <div class="col-md-4"></div>
              </div>
            </form>
                </div>
            </div>
        </div>
    </div>  
  </div>  
   

     <!-- unit modal -->
          
     <div class="modal fade" id="newunit">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">Add Unit</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalUnit">
                <div class="row mt-2">
                  <div class="col-md-3 mt-2"></div>
                  <div class="col-md-1 mt-2">
                    <label for="unit" style="color: rgb(190, 88, 88);">Unit</label>
                  </div>

                  <div class="col-md-4 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="unit" name="unit" required>
                  </div>
                  <div class="col-md-4 mt-2"></div>
                </div>
                
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="unitSave">Save
                      </button> 
                      

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>


    <!-- account modal -->

    <div class="modal fade" id="newaccount">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Account</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalAccount">
        
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="">Account Type</label><br>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="acct_type" name="acct_type" required>
                  </div>
                </div>
                
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cfname">Account name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control bg-light text-dark" id="acct_name" name="acct_name" required>
                  </div>
                </div>            

                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="accountSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>  


    <!-- end of modal -->



    
  </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>

////////////////////old code//////////////////////////////////////////////

  $(document).ready(function () {
  var rowCount = 2; // Initialize rowCount to the next available number

  // Event handler for clone button
  $('#item_table').on('click', '.clone-row', function () {
    var row = $(this).closest('tr');
   
    var newRowId = 'row' + rowCount; // Generate a new ID for the cloned row
    clonedRow.attr('id', newRowId); // Set the new ID for the cloned row

    // Clone the options for tax, account, and item (if needed)
    // ...

    rowCount++; // Increment row counter

    $('#item_table tbody').append(clonedRow);
    calculateRowAmount(row);
    calculateSubtotal();
    calculateGrandTotal();
    toggleDateInput();
    calculateTaxAmount();
    toggleDateInput();
  });

  // Event handler for "Add another line" button
  $('#add-row-button').click(function () {
    var lastRow = $('#item_table tbody tr:last'); // Get the last row
    var newRow = lastRow.clone(); // Clone the last row
    var newRowId = 'row' + rowCount; // Generate a new ID for the cloned row
    newRow.attr('id', newRowId); // Set the new ID for the cloned row

    // Clear input values in the cloned row if needed
    newRow.find('input[type="number"]').val(0);

    $('#item_table tbody').append(newRow);
    rowCount++; // Increment row counter
  });
});


// Change event listener for the tax dropdown
$('#item_table').on('change', 'select[name^="tax"]', function () {
    // Calculate CGST, SGST, or IGST based on the selected tax type
    var selectedTaxType = $(this).val();
    var subtotal = parseFloat($('#subtotal').val()) || 0;

    if (selectedTaxType === '0' || selectedTaxType === '3' || selectedTaxType === '5' || selectedTaxType === '12' || selectedTaxType === '18' || selectedTaxType === '28') {
        // GST selected
        var gstPercentage = parseFloat(selectedTaxType);
        var cgst = (subtotal * (gstPercentage / 2)) / 100;
        var sgst = cgst;

        $('#tr_cgst').show();
        $('#tr_sgst').show();
        $('#tr_igst').hide();

        $('#cgst').val(cgst.toFixed(2));
        $('#sgst').val(sgst.toFixed(2));
        $('#igst').val('0.00');
    } else {
        // IGST selected
        $('#tr_cgst').hide();
        $('#tr_sgst').hide();
        $('#tr_igst').show();

        $('#cgst').val('0.00');
        $('#sgst').val('0.00');
        $('#igst').val(subtotal.toFixed(2));
    }

    // Update tax total
    calculateTaxTotal();
});
</script>




<!-- Payment -->
<script>
     
  // Select the form and the container for the terms rows
const form = document.getElementById('terms-form');
const termsContainer = document.getElementById('terms-container');

// Select the button that adds new rows
const addTermRowBtn = document.querySelector('.add-term-row');

// Add event listener to the button
addTermRowBtn.addEventListener('click', () => {
  // Create a new row div
  const newRow = document.createElement('div');
  newRow.classList.add('form-row');

  // Create the first input field for the new row
  const termsInput = document.createElement('div');
  termsInput.classList.add('col-6');
  const termsField = document.createElement('input');
  termsField.type = 'text';
  termsField.name = 'term';
  termsField.placeholder = 'Terms';
  termsField.classList.add('form-control');
  termsField.classList.add('text-black');
  termsInput.appendChild(termsField);
  newRow.appendChild(termsInput);

  // Create the second input field for the new row
  const daysInput = document.createElement('div');
  daysInput.classList.add('col-5');
  const daysField = document.createElement('input');
  daysField.type = 'text';
  daysField.name = 'days';
  daysField.placeholder = 'No of Days';
  daysField.classList.add('form-control');
  daysField.classList.add('text-black');
  daysInput.appendChild(daysField);
  newRow.appendChild(daysInput);

  // Create the delete button for the new row
  const deleteBtn = document.createElement('div');
  deleteBtn.classList.add('col-1');
  const deleteBtnEl = document.createElement('button');
  deleteBtnEl.type = 'button';
  deleteBtnEl.classList.add('btn', 'btn-danger', 'delete-term-row');
  deleteBtnEl.innerText = '-';
  deleteBtn.appendChild(deleteBtnEl);
  newRow.appendChild(deleteBtn);

  // Append the new row to the container
  termsContainer.appendChild(newRow);
});

// Add event listener to the form to delete rows
termsContainer.addEventListener('click', (event) => {
  // If the target element is a delete button
  if (event.target.classList.contains('delete-term-row')) {
    // Find the row to delete
    const row = event.target.closest('.form-row');
    // Remove the row
    row.remove();
  }
});

</script>





<script>
  
  $(document).ready(function() {
    $("#cfname, #clname").change(function() {
      $("#cdisplayname").text($("#ctitle").val() +" " + $("#cfname").val() + " " + $("#clname").val());
    });
  });

  $(document).ready(function() {
    $("#c_gsttype").change(function() {
      var x=$('#c_gsttype').val();
      console.log(x)
      if(x=="Unregistered Business-not Registered under GST") 
      {
        $(".gstrow").addClass('d-none');
        

      }
      else if(x == 'Overseas- Persons with who you do import or exports of supplies outside india'){
        $(".gstrow").addClass('d-none');
        console.log('poor')
      }
      else 
      {
        $(".gstrow").removeClass('d-none');
        $(".gstrow").addClass('d-flex');
      
      }
    
    });
  });

 


    $(document).ready(function() {
    $("#c_gstin").change(function() {

        var x=$("c_gstin").val();
        var gst_label=document.getElementById("gst_label")
        var expr=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
        if (!expr.test(x)) {
            gst_label.style.color="red";
            gst_label.innerHTML = "Invalid GST Number.";
        }
        else{
            gst_label.style.color="green";
            gst_label.innerHTML = "valid GST Number.";

        }
      });
    });

    $(document).ready(function() {
      $("#c_pan").change(function() {
        var x= $("#c_pan").val();
        var pan_label=document.getElementById("pan_label")
        var expr=    /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/
        if (!expr.test(x)) {
            pan_label.style.color="red";
            pan_label.innerHTML = "Invalid PAN Number.";
        }
        else{
            pan_label.style.color="green";
            pan_label.innerHTML = "valid PAN Number.";

        }
      });
    });


  function addressSame(){
    var chkbtn = document.getElementById('vokay');
    if (chkbtn.checked == true) {
      document.getElementById('vsstreet').value = document.getElementById('vstreet').value;
      document.getElementById('vscity').value = document.getElementById('vcity').value;
      document.getElementById('vspincode').value = document.getElementById('vpincode').value;
      document.getElementById('vscountry').value = document.getElementById('vcountry').value;
      document.getElementById('vsstate').value = document.getElementById('vstate').value;
      document.getElementById('vsphone').value = document.getElementById('vphone').value;
      document.getElementById('vsfax').value = document.getElementById('vfax').value;
    } 
    else {
      document.getElementById('vsstreet').value = '';
      document.getElementById('vscity').value = '';
      document.getElementById('vsstate').value = '';
      document.getElementById('vspincode').value = '';
      document.getElementById('vscountry').value = '';
      document.getElementById('vsphone').value = '';
      document.getElementById('vsfax').value = '';
    }
  }



  function address(){
    var chkbtn = document.getElementById('voka');
    if (chkbtn.checked == true) {
      document.getElementById('csstreet').value = document.getElementById('cstreet').value;
      document.getElementById('cscity').value = document.getElementById('ccity').value;
      document.getElementById('cspincode').value = document.getElementById('cpincode').value;
      document.getElementById('cscountry').value = document.getElementById('ccountry').value;
      document.getElementById('csstate').value = document.getElementById('cstate').value;
      document.getElementById('csphone').value = document.getElementById('cphone').value;
      document.getElementById('csfax').value = document.getElementById('cfax').value;
    } 
    else {
      document.getElementById('csstreet').value = '';
      document.getElementById('cscity').value = '';
      document.getElementById('csstate').value = '';
      document.getElementById('cspincode').value = '';
      document.getElementById('cscountry').value = '';
      document.getElementById('csphone').value = '';
      document.getElementById('csfax').value = '';
    }
  }


//---payment terms


$(document).on("click", "#payment", function() {
  var array1 = [];
  var array2 = [];
  $("input:text[name=terms]").each(function() {
    array1.push($(this).val());
   
  });
  $("input:text[name=days]").each(function() {
    array2.push($(this).val());
  });
 

  $.ajax({
    url: "{% url 'payment_term_for_sales' %}",
    type: 'POST',
    headers: { 'X-CSRFToken': '{{ csrf_token }}' },
    data: {
      terms: JSON.stringify(array1),
      days: JSON.stringify(array2)
    },
    success: function(response) {
      
      
      $('#newpayment').hide();
      
      $(".modal-backdrop").remove();
      data = response.pay_term;
      const pay = document.getElementById("pay_term");
      console.log(pay)
      const termsField = document.createElement('option');
      termsField.innerHTML = data;
      pay.appendChild(termsField);
   
      
  // Iterate through the data and create options
    },
  });
});



//------customer create 






$(document).on("click","#customersave",function(){
  if ($('input[name="radioCust"]:checked').val() == 'Business'){

    itemtype = $('#business').val();
  }
  else{
    itemtype = $('#individual').val();
  }

  if ($('input[name="radioOption2"]:checked').val() == 'Taxable'){
    inte = $('#item-tax3').val();
    
  }
  else{
    inte = $('#item-tax4').val();
  }

console.log('saved')

  $.ajax({
    
    type : 'POST',
    url:"{% url 'credit_customer' %}",

    data:{
        tax:inte,
        itemtype:itemtype,
        title : $("#ctitle").val(),
        firstname : $("#cfname").val(),
        lastname : $("#clname").val(),
        company_name : $("#ccompany").val(),
        display_name : $('#cdisplayname').text(),
        email : $("#cemail").val(),
        website :$("#cwsite").val(),
        work_mobile :$("#cw_mobile").val(),
        pers_mobile :$("#cp_mobile").val(),
        skype :$("#cskype").val(),
        facebook :$("#facebook").val(),
        twitter :$("#twitter").val(),
        desg :$("#c_desg").val(),
        dpt :$("#c_dpt").val(),
        gsttype :$("#c_gsttype").val(),
        gstin :$("#c_gstin").val(),
        panno : $("#c_pan").val(),
        placesupply :$("#placesupply").val(),
        currency : $("#c_curn").val(),
        openingbalance : $("#c_open").val(),
        paymentterms : $("#c_terms").val(),
        street : $("#cstreet").val(),
        city : $("#ccity").val(),
        state : $("#cstate").val(),
        pincode : $("#cpincode").val(),
        fax : $("#cfax").val(),
        phone : $("#cphone").val(),
        country : $("#ccountry").val(),
        shipstreet : $("csstreet").val(),
        shipcity : $("#cscity").val(),
        shipstate : $("#csstate").val(),
        shippincode : $("#cspincode").val(),
        shipcountry : $("#cscountry").val(),
        shipfax : $("#csfax").val(),
        shipphone : $("#csphone").val(),
        radioCust: $("input[name='radioCust']:checked").val(),
        csrfmiddlewaretoken: '{{ csrf_token }}',
      },
      
      success: function(response) {
        document.getElementById("modalCustomer").reset();
      // new
       // Assuming response contains the ID and name of the new customer
       var newCustomer = $('<option></option>').attr('value', response.id).text(response.name);
      newCustomer.data('email', response.email);
      newCustomer.data('pos', response.place_of_supply);
      newCustomer.data('gst', response.GSTTreatment);
      newCustomer.data('gstin', response.GSTIN);
      newCustomer.data('billing_address', response.Address1);
      
      $('#customer_sel').append(newCustomer);

      // Attach the change event listener to the customer dropdown
      $('#customer_sel').change(function () {
        // Get the selected customer information
        var selectedCustomer = $('#customer_sel option:selected');
        var email = selectedCustomer.data('email');
        var placeOfSupply = selectedCustomer.data('pos');
        var gstTreatment = selectedCustomer.data('gst');
        var gstin = selectedCustomer.data('gstin');
        var billingAddress = selectedCustomer.data('billing_address');

        // Content of the placeholders
        $('#email_input').val(email);
        $('#pos_input').val(placeOfSupply);
        $('#gst_input').val(gstTreatment);
        $('#gstin_input').val(gstin);
        $('#billing_address_input').val(billingAddress);

        // Show or hide fields based on selection
        if (selectedCustomer.val() !== '') {
          $('#email_row').show();
          $('#pos_row').show();
          $('#gst_row').show();
          $('#gstin_row').show();
          $('#billing_address_row').show();
        } else {
          $('#email_row').hide();
          $('#pos_row').hide();
          $('#gst_row').hide();
          $('#gstin_row').hide();
          $('#billing_address_row').hide();
        }
      });

      reloadcustomer();
    },
    error: function (xhr, status, error) {
      console.error(xhr.responseText);
    }
  });
});

function reloadcustomer() {
  $.ajax({
    url: "{% url 'customer_dropdown_credit' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',
    success: function (data) {
      var dropdown = $('#customer_sel');
      dropdown.empty(); // Clear the dropdown before populating it again

      $.each(data, function (key, value) {
        dropdown.append($('<option></option>').attr('value', key).text(value).val(key));
      });
    },
    error: function (xhr, status, error) {
      console.error(xhr.responseText);
    }
  });
}
     
  






//--unit create
$(document).on("click","#unitSave",function(){
            $.ajax({
              
              type : 'POST',
              url:"{% url 'purchase_unit_credit' %}",
          
              data:{
                  unit : $("#unit").val(),      
                  csrfmiddlewaretoken: '{{ csrf_token }}'
                  
                },
              
                success: function(response) {
                  document.getElementById("modalUnit").reset();
                  reloadUnit();
                },
            });        
          });
          
          
          function reloadUnit() {
          
            $.ajax({
              url: "{% url 'purchase_unit_dropdown_credit' %}",
              type: "GET",
              dataType: "json",
              data: $(this).serialize(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
          
              success: function(data) {
                var dropdown = $('#item_units');
                dropdown.empty();
          
                $.each(data, function(key, value) {
                    dropdown.append($('<option></option>').attr('value', key).text(value).val(value));
                });
              },
              error: function(xhr, status, error) {
              console.error(xhr.responseText);
              }
            });
          }
          
////////initial load////////////////////////
$(document).ready(function () {
  loadInitialItems(); // Call the function when the document is ready
});

function loadInitialItems() {
  $.ajax({
    url: "{% url 'load_initial_items' %}",
    type: "GET",
    dataType: "json",
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function (data) {
      var dropdown = $('.itm');
      dropdown.empty();

      // Parse the serialized JSON data
      var parsedData = JSON.parse(data);

      $.each(parsedData, function (index, item) {
        dropdown.append($('<option></option>').attr('value', item.pk).text(item.fields.Name).val(item.pk));
      });
    },
    error: function (xhr, status, error) {
      console.error(xhr.responseText);
    }
  });
}



 




//////////////item create///////////////////////////////////////////////////


          
$(document).ready(function() {
            $("#item-tax1").click(function() {
            //  console.log($("#item_units").val().split(' ')[0]);
              $(".inter-intra").removeClass('d-none');
              $(".inter-intra").addClass('d-flex');
            });
          
            $("#item-tax2").click(function() {
          
              $(".inter-intra").removeClass('d-flex');
              $(".inter-intra").addClass("d-none");
            });
          });
          
          $(document).ready(function() {
            $("#item-tax3").click(function() {
            //  console.log($("#item_units").val().split(' ')[0]);
              $(".inter-intra").removeClass('d-none');
              $(".inter-intra").addClass('d-flex');
            });
          
            $("#item-tax4").click(function() {
          
              $(".inter-intra").removeClass('d-flex');
              $(".inter-intra").addClass("d-none");
            });
          });
          
          $(document).on("click","#itemSave",function(){
          
            if ($('input[name="radioOption"]:checked').val() == 'Goods'){
          
                itemtype = $('#item_type1').val();
              }
            else{
              itemtype = $('#item_type2').val();
            }
          
            if ($('input[name="radioOption1"]:checked').val() == 'Taxable'){
                inter = $('#inter').val();
                intra = $('#intra').val();
              }
            else{
              inter = 0;
              intra = 0;
            }
          
            console.log('saved')
            $.ajax({
              
              type : 'POST',
              url: "{% url 'purchase_item_credit' %}", 

              
              data:{
                  type : itemtype,
                  name : $("#item_name").val(),
                  unit : $("#item_units").val(),
                  inter : inter,
                  intra : intra,
                  sell_price : $("#sell_price").val(),
                  cost_price : $("#cost_price").val(),
                  sell_acc : $("#sell_acc").val(),
                  cost_acc : $("#cost_acc").val(),
                  sell_desc : $("#sell_desc").val(),
                  cost_desc : $("#cost_desc").val(),

                  item_hsn: $("#item_hsn").val(),  
                  
                
                  
                  csrfmiddlewaretoken: '{{ csrf_token }}'
                  
                },
              
                success: function(response) {
                  document.getElementById("modalItem").reset();
                  reloadItem();
                },
            });        
          });
          
          
          function reloadItem() {
            $.ajax({
              url: "{% url 'purchase_item_dropdown_credit' %}",
              type: "GET",
              dataType: "json",
              data: $(this).serialize(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
          
              success: function(data) {
                var dropdown = $('.itm');
                dropdown.empty();
          
                $.each(data, function(key, value) {
                    dropdown.append($('<option></option>').attr('value', key).text(value).val(value));
                });
              },
              error: function(xhr, status, error) {
              console.error(xhr.responseText);
              }
            });
          }






// account modal

$(document).on("click","#accountSave",function(){

  $.ajax({
    
    type : 'POST',
    url:"{% url 'purchase_account' %}",
    
    data:{
        actype : $("#acct_type").val(),
        acname : $("#acct_name").val(),
     
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalAccount").reset();
        reloadAccount();
      },
  });        
});


function reloadAccount() {
  $.ajax({
    url: "{% url 'purchase_account_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('.acnt');
      dropdown.empty();

      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value).val(value));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

</script>
<!-- Tax dropdown according to place of supply -->





<script>
  $(document).ready(function () {


      var roinc = 0
      console.log("ajax");
      // var place = document.getElementById('pos').value;

      $(document).on('click', '#item1', function () {
          select = $('#item1').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  data4=response.place
                  document.getElementById('rate1').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst1').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst1').value = data1
                  }
                  document.getElementById('tigst1').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst1').value = data2

              }
          });

      });
      // console.log('pos:'+place_of_supply);
      $(document).on('click', '#item2', function () {
          select = $('#item2').val();
          customer = $('#customer_sel').val();
          

          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate2').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst2').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst2').value = data1
                  }
                  document.getElementById('tigst2').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst2').value = data2

              }
          });

      });

      $(document).on('click', '#item3', function () {
          select = $('#item3').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate3').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst3').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst3').value = data1
                  }
                  document.getElementById('tigst3').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst3').value = data2

              }
          });

      });

      $(document).on('click', '#item4', function () {
          select = $('#item4').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate4').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst4').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst4').value = data1
                  }
                  document.getElementById('tigst4').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst4').value = data2

              }
          });

      });

      $(document).on('change', '#item5', function () {
          select = $('#item5').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate5').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst5').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst5').value = data1
                  }
                  document.getElementById('tigst5').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst5').value = data2

              }
          });

      });

      $(document).on('change', '#item6', function () {
          select = $('#item6').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate6').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst6').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst6').value = data1
                  }
                  document.getElementById('tigst6').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst6').value = data2

              }
          });

      });

      $(document).on('change', '#item7', function () {
          select = $('#item7').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate7').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst7').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst7').value = data1
                  }
                  document.getElementById('tigst7').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst7').value = data2

              }
          });

      });

      $(document).on('change', '#item8', function () {
          select = $('#item8').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate8').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst8').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst8').value = data1
                  }
                  document.getElementById('tigst8').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst8').value = data2

              }
          });

      });

      $(document).on('change', '#item9', function () {
          select = $('#item9').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate9').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst9').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst9').value = data1
                  }
                  document.getElementById('tigst9').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst9').value = data2

              }
          });

      });

      $(document).on('change', '#item10', function () {
          select = $('#item10').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate10').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst10').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst10').value = data1
                  }
                  document.getElementById('tigst10').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst10').value = data2

              }
          });

      });

      $(document).on('change', '#item11', function () {
          select = $('#item11').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate11').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst11').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst11').value = data1
                  }
                  document.getElementById('tigst11').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst11').value = data2

              }
          });

      });

      $(document).on('change', '#item12', function () {
          select = $('#item12').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate12').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst12').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst12').value = data1
                  }
                  document.getElementById('tigst12').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst12').value = data2

              }
          });

      });

      $(document).on('change', '#item13', function () {
          select = $('#item13').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate13').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst13').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst13').value = data1
                  }
                  document.getElementById('tigst13').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst13').value = data2

              }
          });

      });

      $(document).on('change', '#item14', function () {
          select = $('#item14').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate14').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst14').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst14').value = data1
                  }
                  document.getElementById('tigst14').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst14').value = data2

              }
          });

      });

      $(document).on('change', '#item15', function () {
          select = $('#item15').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate15').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst15').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst15').value = data1
                  }
                  document.getElementById('tigst15').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst15').value = data2

              }
          });

      });

      $(document).on('change', '#item16', function () {
          select = $('#item16').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate16').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst16').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst16').value = data1
                  }
                  document.getElementById('tigst16').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst16').value = data2

              }
          });

      });

      $(document).on('change', '#item17', function () {
          select = $('#item17').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate17').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst17').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst17').value = data1
                  }
                  document.getElementById('tigst17').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst17').value = data2

              }
          });

      });

      $(document).on('change', '#item18', function () {
          select = $('#item18').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate18').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst18').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst18').value = data1
                  }
                  document.getElementById('tigst18').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst18').value = data2

              }
          });

      });

      $(document).on('change', '#item19', function () {
          select = $('#item19').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate19').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst19').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst19').value = data1
                  }
                  document.getElementById('tigst19').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst19').value = data2

              }
          });

      });

      $(document).on('change', '#item20', function () {
          select = $('#item20').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate20').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst20').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst20').value = data1
                  }
                  document.getElementById('tigst20').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst20').value = data2

              }
          });

      });

      $(document).on('change', '#item21', function () {
          select = $('#item21').val();
          customer = $('#customer_sel').val();
          console.log(select);
          console.log(customer);
          $.ajax({
              type: "GET",
              url: "{% url 'itemdata' %}",
              data: {
                  id: select,
                  cust: customer
              },
              success: function (response) {
                  console.log(response)
                  data = response.rate
                  data1 = response.gst
                  data2 = response.igst
                  data3 = response.pos
                  document.getElementById('rate21').value = data

                  if (data3 == '{{ company.state }}') {
                      document.getElementById('tgst21').innerHTML = data1 + ' % GST';
                      document.getElementById('tgst21').value = data1
                  }
                  document.getElementById('tigst21').innerHTML = data2 + ' % IGST';
                  document.getElementById('tigst21').value = data2

              }
          });

      });


  });


///////////////////////////////get hsn & rate////////////////////////////////////////////////////


function fetchItemData(selectedItem, row) {
    $.ajax({
        type: 'GET',
        url: "{% url 'get_item_details' %}",
        data: {
            id: selectedItem
        },
        dataType: 'json',
        success: function (response) {
            // Update the HSN and rate fields in the current row with the fetched data
            row.find(".hsn").val(response.hsn);
            row.find(".rate").val(response.rate);
        },
        error: function () {
            // Handle errors if the data cannot be fetched or the item doesn't exist
            console.log('Error fetching item data.');
            // You can display an error message to the user if needed.
        },
    });
}

// Add event handler for changes in item selection
$(document).on('change', '.item_select', function () {
    var selectedItem = $(this).val();
    var row = $(this).closest('tr');
    fetchItemData(selectedItem, row);
});


// Add event handler for changes in item selection
$(document).on('change', '.item_select', function () {
  var selectedItem = $(this).val();
  var row = $(this).closest('tr');
  
  $.ajax({
    type: 'GET',
    url: "{% url 'get_item_details' %}",
    data: {
      id: selectedItem
    },
    dataType: 'json',
    success: function (response) {
      // Update the HSN and rate fields in the current row with the fetched data
      row.find(".hsn").val(response.hsn);
      row.find(".rate").val(response.rate);
    },
    error: function () {
      // Handle errors if the data cannot be fetched or the item doesn't exist
      console.log('Error fetching item data.');
      // You can display an error message to the user if needed.
    },
  });
});



  </script>
  
  <script>
    $(document).ready(function () {
  
  // Function to update tax dropdown options based on place of supply
  function updateTaxDropdown(placeOfSupply) {
      var taxDropdown = $('#tax1');
  
      // Remove existing options
      taxDropdown.empty(); // Clear the dropdown options
  
      // Convert the placeOfSupply to lowercase for case-insensitive comparison
      var lowerPlaceOfSupply = placeOfSupply.toLowerCase();
  
      if (lowerPlaceOfSupply === '[kl]-kerala' || lowerPlaceOfSupply === 'kerala' || lowerPlaceOfSupply === '[kl] kerala') {
          // Add GST options for Kerala
          taxDropdown.append('<optgroup class="text-center" label="GST">' +
              '<option value="0" selected></option>' +
              '<option value="3">3.0% GST(3%)</option>' +
              '<option value="5">5.0% GST(5%)</option>' +
              '<option value="12">12.0% GST(12%)</option>' +
              '<option value="18">18.0% GST(18%)</option>' +
              '<option value="28">28.0% GST(28%)</option>' +
              '</optgroup>');
      } else {
          // Add IGST options for other states
          taxDropdown.append('<optgroup class="text-center" label="IGST">' +
              '<option value="0">0% IGST(0%)</option>' +
              '<option value="3">3.0% IGST(3%)</option>' +
              '<option value="5">5.0% IGST(5%)</option>' +
              '<option value="12">12.0% IGST(12%)</option>' +
              '<option value="18">18.0% IGST(18%)</option>' +
              '<option value="28">28.0% IGST(28%)</option>' +
              '</optgroup>');
      }
  }
  
        // Change event listener for the customer dropdown
        $('#customer_sel').change(function () {
            var selectedCustomer = $('#customer_sel option:selected');
            var placeOfSupply = selectedCustomer.data('pos');
  
            // Update tax dropdown based on place of supply
            updateTaxDropdown(placeOfSupply);
        });
  
        // Event handler for changes in quantity, rate, and discount fields
        $(document).on('change keyup', 'input[name^="quantity"], input[name^="rate"], input[name^="discount"], select[name^="tax"]', function () {
            // Get the parent row of the changed input
            var row = $(this).closest('tr');
  
            // Get the values of quantity, rate, and discount for the row
            var quantity = parseFloat(row.find('input[name^="quantity"]').val()) || 0;
            var rate = parseFloat(row.find('input[name^="rate"]').val()) || 0;
            var discount = parseFloat(row.find('input[name^="discount"]').val()) || 0;
  
            // Calculate the total amount for the row
            var totalAmount = (quantity * rate) - discount;
  
            // Update the corresponding total amount input field with the calculated value
            row.find('input[name^="amount"]').val(totalAmount.toFixed(2));
  
            // Calculate the subtotal
            var subtotal = 0;
            $('input[name^="amount"]').each(function () {
                subtotal += parseFloat($(this).val()) || 0;
            });
  
            // Update the subtotal input field with the calculated value
            $('#subtotal').val(subtotal.toFixed(2));
  
            // Determine the selected tax type (GST or IGST)
            var selectedTaxType = row.find('select[name^="tax"]').val();
  
            var selectedCustomer = $('#customer_sel option:selected');
  var placeOfSupply = selectedCustomer.data('pos');
  
  // Calculate tax based on the selected tax type and place of supply
  var normalizedPlaceOfSupply = placeOfSupply.replace(/\[|\]|-/g, '').toLowerCase();
  
  // Check if the normalizedPlaceOfSupply contains "kerala"
  if (normalizedPlaceOfSupply.includes('kerala')) {
      // Calculate CGST and SGST based on the selected GST percentage (half of the GST percentage each)
      var gstPercentage = parseFloat(selectedTaxType);
      cgst = (subtotal * (gstPercentage / 2)) / 100;
      sgst = cgst;
  
      $('#tr_cgst').show();
      $('#tr_sgst').show();
      $('#tr_igst').hide();
  
      // Set IGST input field to zero
      $('#igst').val('0.00');
  
      // Calculate tax total as the sum of CGST and SGST
      var taxTotal = cgst + sgst;
  
      // Show the tax total element and set its value
      $('#tax_total').show().val(taxTotal.toFixed(2));
  } else {
      // Calculate IGST based on the selected GST percentage
      var igstPercentage = parseFloat(selectedTaxType);
      igst = (subtotal * igstPercentage) / 100;
  
      $('#tr_cgst').hide();
      $('#tr_sgst').hide();
      $('#tr_igst').show();
  
      if (selectedTaxType === '0') {
          // If the tax type is GST and place of supply is not Kerala, set CGST and SGST to zero
          $('#cgst').val('0.00');
          $('#sgst').val('0.00');
      }
  
      if (selectedTaxType !== '0') {
          // If the tax type is IGST, set CGST and SGST to zero
          $('#cgst').val('0.00');
          $('#sgst').val('0.00');
      }
  
      // Update the IGST input field and tax total to be the same
      $('#igst').val(igst.toFixed(2));
      $('#tax_total').val(igst.toFixed(2));
  
  }
  
              
    });
  
        // Initial setup for tax dropdown based on place of supply
        var initialPlaceOfSupply = $('#pos_input').val();
        updateTaxDropdown(initialPlaceOfSupply);
  
        // Function to calculate the grand total
        function calculateGrandTotal() {
            var subtotal = parseFloat($('#subtotal').val()) || 0;
            var taxTotal = parseFloat($('#tax_total').val()) || 0;
            var shippingCharge = parseFloat($('#shipping').val()) || 0;
            var Adjustment = parseFloat($('#adjustment').val()) || 0;
  
            console.log('Subtotal:', subtotal);
            console.log('Tax Total:', taxTotal);
            console.log('Shipping Charge:', shippingCharge);
            console.log('Adjustment:', Adjustment);
  
            var grandTotal = subtotal + taxTotal + shippingCharge + Adjustment;
  
            console.log('Grand Total:', grandTotal);
  
            $('#grandtotal').val(grandTotal.toFixed(2));
        }
  
        $('#adjustment').on('input', function () {
            calculateGrandTotal();
        });
    });
  </script>
  
{% endblock %}