{% extends 'base.html' %}
{% block content %}
{% load static %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<style>

    input[type=text], select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    
    label {
      padding: 12px 12px 12px 0;
      display: inline-block;
    }
    
    
    .row:after {
      content: "";
      display: table;
      clear: both;
    }
    
    @media screen and (max-width: 600px) {
      .col-25, .col-75, input[type=submit] {
        width: 100%;
        margin-top: 0;
      }
      input[type=text], select, textarea {
      width: 100%;

    }
    }

    .dropdown input,
    .dropdown button {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
    }

    .dropdown.open input,
    .dropdown.open button {
      display: block;
    }

    .row a{
      color: rgb(218, 164, 48);
      font-size: 12px;
    }

    .table th a{
      color:rgb(218, 164, 48);
      font-size: 11px;
      margin-left: 100px;
    }


    ::-webkit-scrollbar {
    width: 5px; 
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }

  ::-webkit-scrollbar-thumb {
    background: #888; 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #555; 
  }
  .modal{
      z-index: 9999;
      overflow: scroll;
    }

    .item{
      height: auto;
    }

    </style>


<div class="container-fulid containerprof">
  <input type="hidden" id="company_state" value="{{company.state}}" readonly>

  <div class="card radius-15 p-3">
    <div class="card-body">
        <div class="card-title">
          <h2 class="mb-0 text-uppercase text-right"><i class="fas fa-file-edit"></i> &nbsp; Update Recurring Bills</h2>
        </div>
    </div>
  </div>

  <div class="card radius-15 p-5">
    <form action="" class="mt-2 mb-4" method="post" enctype="multipart/form-data" id="forms">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Vendor Name *</label>
        </div>
        <div class="col-md-6">
          <select name="vendor" id="vendor" class="form-control text-dark bg-light" >
            <option value="{{recur_bills.vendor_name}}" selected class="text-dark bg-light">{{vend_name}}</option>

            <div class="dropdown-divider"></div>
            {% for v in vendor %}
            <option value="{{v.id}} {{ v.first_name }} {{ v.last_name }}">{{ v.first_name }} {{ v.last_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <a data-toggle="modal" data-target="#newvendor">
            <i class="fas fa-plus p-2 rounded " style="color: white; background-color: rgb(210, 132, 30); "
                data-toggle="tooltip" title="Create Vendor"></i>
          </a>
        </div>
      </div>

      <div class="row mt-2" id="email_row">
        <div class="col-md-3">
          <label for="email_inp">Vendor Email</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light" id="email_inp" name="email_inp">
        </div>
      </div>

      <div class="row mt-2" id="gst_trt_row">
        <div class="col-md-3">
          <label for="gst_trt_inp">GST Treatment</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light" id="gst_trt_inp" name="gst_trt_inp" >
        </div>
      </div>

      <div class="row mt-2 mb-2" id="gstin_row">
        <div class="col-md-3">
          <label for="gstin_inp">GST Number</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light" id="gstin_inp" name="gstin_inp">
        </div>
      </div>

      <div class="row mt-2 mb-2">
        <div class="col-md-3">
          <label>Source of Supply*</label>
        </div>

        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light"  id="vsrcofsupply" name="vsrcofsupply"  >
        </div>
      </div> 
      
      

      <div class="row mt-2">
        <div class="col-md-3">
          <label for="prof_name" style="color: rgb(190, 88, 88);" >Profile Name *</label>
        </div>

        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light"  id="prof_name" name="prof_name" value="{{recur_bills.profile_name}}">
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-3">
          <label for="" style="color: rgb(190, 88, 88);">Repeat Every *</label>
        </div>

        <div class="col-md-6">
          <div class="d-flex">
            <!-- <select class="form-control text-dark bg-light" required name="repeat">
                <option selected value="{{recur_bills.repeat_every}}">{{recur_bills.repeat_every}}</option>
                <option value="1 Week">Week</option>
               
                <option value="1 Month">Month</option>
                
                <option value="1 Year">Years</option>
               
            </select> -->
           
            <select class="form-control text-dark bg-light" id="repeats"  name="repeats"> 
              <option selected value="{{recur_bills.repeat_every}}">{{recur_bills.repeat_every}}</option>
            </select>
            
          </div>   
        </div>
        <div class="col-md-3">
          <a data-toggle="modal" data-target="#newrepeat">
            <i class="fas fa-plus p-2 rounded " style="color: white; background-color: rgb(210, 132, 30); "
                data-toggle="tooltip" title="Add Repeat"></i>
        </a>
        </div>
      </div>
      <br><br>

      <div class="row mt-2" >
        <div class="col-md-3">
          <div class="col-sm-2"><label for="bills">Recurring Bill#*</label></div>
        </div>
       
          <div class="col-md-6"><input type="text" id="bills" name="bills"
            class="form-control bg-white text-dark" value="{{ recur_bills.bill_no}}">
        </div>
    </div>


      <div class="row mt-2" >
          <div class="col-md-3">
            <label for="date1">Starts On</label>
          </div>
          <div class="col-md-3">
            <input type="date" class="form-control text-dark bg-light" id="date1" name="start_date" value="{{ recur_bills.start_date| date:'Y-m-d' }}">
          </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-3">
          <label for="date2">Ends On</label>
        </div>
        <div class="col-md-3">
          <input type="date" class="form-control text-dark bg-light"  id="date2" name="end_date" value="{{ recur_bills.end_date| date:'Y-m-d' }}">
        </div>
        <div class="col-md-3">
          <input type="checkbox" id="never-expire-checkbox" onchange="toggleDateInput()" />
          <label for="never-expire-checkbox" style="color: #909091;" name="neverExp">Never Expires</label>
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-3">
          <label for="date2">Payment Terms {{recur_bills.payment_terms}}</label>
        </div>
        <div class="col-md-6">
          <div class="d-flex">
            <select class="form-control text-dark bg-light" id="terms" required name="terms" >
              <option selected value="{{recur_bills.payment_terms}}">
                
                {% if recur_bills.payment_terms == "recpt" %}
                Due on receipt
                {% else %}
                        {{recur_bills.payment_terms }}
                {% endif %}
              </option>
              
               <option value="30">NET 30</option>
              
              <option value="60">NET 60</option>
             
             
              <option value="recpt">Due on receipt</option>  
              {% for p in payments %}
                <option  value="{{p.Days}}" class="text-dark bg-light">{{p.Terms}}</option>
              {% endfor %}
              
            </select>

          </div> 
          <a href="" data-toggle="modal" data-target="#newpayment"><i class="fa fa-gear"></i> Configure Payment Terms</a>
  
        </div>
      </div>  

      <div class="row mb-5 mt-2">
        <div class="col-md-3">
          <label for="">Reverse Charge</label>
        </div>
        <div class="col-md-6">
          <input type="checkbox" id="rvsCharge" name="rvsCharge">
          <label for="rvsCharge" class="mx-3 mt-2">This transaction is applicable for Reverse Charge</label>
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Customer Name *</label><br>
        </div>
        <div class="col-md-6">
          <select name="customer" id="customer" class="form-control text-dark bg-light">
            <option value="{{recur_bills.customer_name}}" selected class="text-dark bg-light">{{cust_name}}</option>    
            {% for c in customer %}
            
            <option value="{{c.id}} {{ c.customerName }}">{{ c.customerName }}</option>
            {% endfor %}
          </select>
          
        
          <input type="hidden" id="cust_state" value="" readonly >

          <input type="hidden" id="company_state" value="{{company.state}}" readonly>

        </div>
        <div class="col-md-3 mt-2">
          <a  data-toggle="modal" data-target="#newcustomer">
            <i class="fas fa-plus p-2 rounded" style="color: white; background-color: rgb(210, 132, 30); "
                data-toggle="tooltip" title="Create Customer"></i>
          </a>
        </div>
      </div>

      <div class="row mt-2" id="cemail_row">
        <div class="col-md-3">
          <label for="cemail_inp">Customer Email</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light"  id="cemail_inp" name="cemail_inp">
        </div>
      </div>
      <div class="row mt-2" id="c_sou_supply_row">
        <div class="col-md-3">
          <label for="srcofsupply">Source Of Supply</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light"  id="srcofsupply" name="srcofsupply"  >
        </div>
      </div>


      <div class="row mt-2" id="cgst_trt_row">
        <div class="col-md-3">
          <label for="gst_trt_inp">GST Treatment</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light"  id="cgst_trt_inp" name="cgst_trt_inp">
        </div>
      </div>

      <div class="row mt-2 mb-2" id="cgstin_row">
        <div class="col-md-3">
          <label for="gstin_inp">GST Number</label>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control text-dark bg-light" id="cgstin_inp" name="cgstin_inp">
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-12 table-responsive-md mt-3">
          <table class="table table-bordered table-hover mt-3" id="tab_logic">
            <thead>
              <tr>
                <th class="text-center text-uppercase">Item Details <br>
                  <a href="" data-toggle="modal" data-target="#newitem" class="text-capitalize">+ add item</a>
                </th>
                <th class="text-center text-uppercase">HSN </th>
                <!-- <th class="text-center text-uppercase">account <br>
                  <a href="" data-toggle="modal" data-target="#newaccount" class="text-capitalize">+ Add Account</a>

                </th> -->
                <th class="text-center text-uppercase">quantity</th>
                <th class="text-center text-uppercase">rate</th>
                <th class="text-center text-uppercase">tax(%)</th>
                <th class="text-center text-uppercase">discount</th>
                <th class="text-center text-uppercase">amount</th>
              </tr>
            </thead>
            <tbody id="items-table-body">
              {% for ri in recur_items %}
              {{forloop.counter|add:"-1"}}
              <tr id='addr{{forloop.counter|add:"-1"}}' class="addr">
                <td style="width: 20%;">
                  <div class="d-flex" >
                    <select name='item[]' id="item{{forloop.counter|add:'-1'}}" class="form-control item text-dark bg-light" onchange = "showRate(this.id,this.value);">
                      <option value="{{ri.item}}" selected >{{ri.item}}</option>
                      {% for i in item %}
                        <option value="{{i.id}}">{{i.Name}}</option>
                      {% endfor %}
                    </select>
                    
                  </div>  
                </td>
                <td  style="width: 50%;">
                  <input type="text" value="{{ri.hsn}}" name='HSN[]' id="HSN{{forloop.counter|add:'-1'}}" placeholder='HSN' class="form-control HSN text-dark bg-light" />
                </td>

               
                <td style="width: 10%;">
                  <input type="text" name='qty[]' placeholder='Qty' id="qty{{forloop.counter|add:'-1'}}" value="{{ri.quantity}}"  class="form-control qty text-dark bg-light" step=0 min=0/>
                </td>
                <td style="width: 10%;">
                  <input type="text" name='rate[]' id="rate{{forloop.counter|add:'-1'}}" placeholder='Rate' value="{{ ri.rate }}" class="form-control rate text-dark bg-light" step="0.00" min="0" />
                </td>
                <td style="width: 15%;">
                  <input type="hidden" id="tax_total{{forloop.counter|add:'-1'}}" class="form-control mb-2 d-none">
                  <input type="text" placeholder="Select TAX" class="form-control selecttax text-dark bg-light" id="selecttax0">
                  <select name="tax1[]" id="intra_tax{{forloop.counter|add:'-1'}}" class="form-control tax1 d-none mb-2 text-dark bg-light">
                    <option id="ta1" value="{{ ri.tax  }} " text="{{ cmp1.state }}" >{{ ri.tax }}% GST({{ ri.tax }}%)</option>
                    <option value=28 text="{{ cmp1.state }}">28.0% GST(28%)</option>
                    <option value=18 text="{{ cmp1.state }}">18.0% GST(18%)</option>
                    <option value=12 text="{{ cmp1.state }}">12.0% GST(12%)</option>
                    <option value=5 text="{{ cmp1.state }}">05.0% GST(05%)</option>
                    <option value=3 text="{{ cmp1.state }}">03.0% GST(03%)</option>
                    <option value=0 text="{{ cmp1.state }}">0.0% GST(0%)</option>
                  </select>

                  <select name="tax2[]" id="inter_tax{{forloop.counter|add:'-1'}}" class="form-control tax2 d-none mb-2 text-dark bg-light">
                    <option id="ta5" value="{{ ri.tax  }} " text="{{ cmp1.state }}">{{ ri.tax }}% IGST({{ ri.tax }}%) </option>                      
                    <option value=28 text="{{ cmp1.state }}">28.0% IGST(28%)</option>
                    <option value=28 text="{{ cmp1.state }}">28.0% IGST(28%)</option>
                    <option value=18 text="{{ cmp1.state }}">18.0% IGST(18%)</option>
                    <option value=12 text="{{ cmp1.state }}">12.0% IGST(12%)</option>
                    <option value=5 text="{{ cmp1.state }}">05.0% IGST(05%)</option>
                    <option value=3 text="{{ cmp1.state }}">03.0% IGST(03%)</option>
                    <option value=0 text="{{ cmp1.state }}">0.0% IGST(0%)</option>
                  </select>
                </td>
                
                <td style="width: 11%;">
                  <input type="text" name='discount[]' id="disc{{forloop.counter|add:'-1'}}" value="{{ri.discount}}" placeholder='Discount' class="text-dark bg-light form-control disc" step="0.00" min="0"/>
                </td>

                <td style="width: 11%;">
                  <input type="text" name='amount[]' id="amount{{forloop.counter|add:'-1'}}" value="{{ri.amount}}" placeholder='Amount' class=" text-dark bg-light form-control amount" step="0.00" min="0" />
                </td>
                <td>
                  <button type="button" id="0" class="btn btn-outline-primary clone_row text-center mb-1 p-1 " data-toggle= "tooltip" data-placement="bottom" tooltip="Clone"
                      style = "width:25px; height: 25px; border-radius: 90% " >
                    <i class="fa-solid fa-clone"></i>
                  </button> 
                    <br>
                  <button type="button" id="0" class="btn btn-outline-danger remove_row text-center p-1" data-toggle= "tooltip" data-placement="bottom" tooltip="Remove"
                      style = "width:25px; height: 25px; border-radius: 90% " >
                    <i class="fa fa-window-close"></i>
                  </button>
                </td>

              </tr>
              {% endfor %}
            </tbody>
            

            <tr>
                <td style="border: none;"><a class="btn btn-outline-secondary ml-1 text-capitalize" role="button" id="add"  
                  title="Add Another Line">+</a></td>
            </tr>
          </table>
        </div>
      </div>

      <div class="row" >
        <div class="col-md-5 mt-2 p-3 mx-5">
          <label for="paymentmethod">Payment Method</label>
          <select name="paymentmethod" id="paymentmethod" class="form-control text-dark bg-light">
            <option value="{{recur_bills.payment_method}}" selected>{{recur_bills.payment_method}}</option>   

          
              <option value="Cash">Cash</option>
              <option value="Cheque">Cheque</option>
              {% for b in bank %}
                  <option value="{{b.name}}">{{b.name}}</option>
              {% endfor %}

          </select>
          </div>
        </div>

      <div class="row clearfix" >
        <div class="col-md-5 mt-2 p-3 mx-5">
          <label for="">Note</label>
          <div class="form-row">
            <textarea class="form-control text-dark bg-light" name="note" rows="15" style="height: 200px;" value="{{recur_bills.note}}">{{recur_bills.note}}</textarea>
          </div><br>
          <div>
            <input type="file" class="form-control" name="file" value="{{recur_bills.document}}">
          </div>
          <div>
          </div>
        </div>
        <div class="col-md-5 table-responsive-md mt-3 ml-5 mr-0 p-2" id="tab_logic_total" style="background-color:rgba(5, 5, 5, 0.4); border: 1px solid rgba(128, 128, 128, 0.6);"><br>
          <div class="row container-fluid p-2 m-0">
            <div class="col-sm-5 mt-2">
              <label for="a" class="text-center">Sub Total</label>
            </div>
            <div class="col-sm-3 mt-2"></div>
            <div class="col-sm-4 mt-2">
              <input type="number" step="any" name='subtotal' placeholder=0 value="{{recur_bills.sub_total}}" step="0.00" min="0"
                class="form-control text-dark bg-light" id="subtotal" readonly style="background-color: #2A3038;border: 1px solid #2c2e33;">
            </div>
          </div>
          
          <div class="row container-fluid p-2 m-0 d-none" id="igst1">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center">IGST</label></div>
            <div class="col-sm-3 mt-2"></div>
            <div class="col-sm-4 mt-2"><input type="number" name='igst'  step="0.00" min="0" id="igst" placeholder=0 value="{{recur_bills.igst}}"
                class="form-control text-dark bg-light" readonly style="background-color: #2A3038;border: 1px solid #2c2e33;"/>
            </div>
          </div>
          <div class="row container-fluid p-2 m-0 d-none" id="cgst1">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center">CGST</label></div>
            <div class="col-sm-3 mt-2"></div>
            <div class="col-sm-4 mt-2"><input type="number" name='cgst' step="0.00" min="0" id="cgst" placeholder=0 value="{{recur_bills.cgst}}"
                class="form-control text-dark bg-light" readonly style="background-color: #2A3038;border: 1px solid #2c2e33;"/>
            </div>
          </div>
          <div class="row container-fluid p-2 m-0 d-none" id="sgst1">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center">SGST</label></div>
            <div class="col-sm-3 mt-2"></div>
            <div class="col-sm-4 mt-2"><input type="number" name='sgst' tep="0.00" min="0" id="sgst" placeholder=0 value="{{recur_bills.sgst}}"
                class="form-control text-dark bg-light" readonly style="background-color: #2A3038;border: 1px solid #2c2e33;"/>
            </div>
          </div>

          <div class="row container-fluid p-2 m-0" id="tax_amount">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center">Tax Amount</label></div>
            <div class="col-sm-3 mt-2"></div>
            <div class="col-sm-4 mt-2"><input type="number" id="total_taxamount" readonly name="total_taxamount"step="0.00" min="0" placeholder=0 value="{{recur_bills.tax_amount}}"
                class="total_taxamount form-control text-dark bg-light"  style="background-color: #2A3038;border: 1px solid #2c2e33;"/>
            </div>
          </div>

          <div class="row container-fluid p-2 m-0">
            <div class="col-sm-5 mt-0">
              <label for="addcharge" class="text-right">Shipping Charges</label>
            </div>
            <div class="col-sm-3 mt-2">
            </div>
            <div class="col-sm-4 mt-2">
              <input type="number" name='addcharge' step="any" id="addcharge" placeholder=0 value="{{recur_bills.shipping_charge}}" step="0.00" min="0"
              class="form-control text-dark bg-light"/>
            </div>
          </div>

          <div class="row container-fluid p-2 m-0">
            <div class="col-sm-5 mt-2"><label class="text-right" >Adjustment</label></div>
            <div class="col-sm-3 mt-2">
            </div>
            <div class="col-sm-4 mt-2">
              <input type="number" name='add_round_off' step="any" id="add_round_off" placeholder=0 value="{{recur_bills.adjustment}}" step="0.00" min="0" class="form-control text-dark bg-light">
            </div>
          </div><hr>
                 
          <div class="row container-fluid  p-2 m-0">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center " id="grandtotallbl">Grand Total</label></div>
            <div class="col-sm-2 mt-2"></div>
            <div class="col-sm-5 mt-2"><input type="number" name='grand_total' id="grandtotal" placeholder="0" tep="0.00" min="0" 
                value="{{recur_bills.grand_total}}"class="form-control text-dark bg-light" readonly>
            </div>
          </div>

          <div class="row container-fluid  p-2 m-0">
            <div class="col-sm-5 mt-2"><label for="a" class="text-center" id="Paid">Paid</label></div>
            <div class="col-sm-2 mt-2"></div>
            <div class="col-sm-5 mt-2"><input type="number" name='amtPaid' id="amtPaid" placeholder="0" step="0.00" min="0"  value="{{recur_bills.amt_paid}}"
                class="form-control text-dark bg-light">
            </div>
          </div>
        </div>   
      </div>
      <div class="row mt-5 mb-3">
        
        <div class="col-md-4">
          <div class="d-flex">
            <!-- <input type="submit" class="btn text-white mt-5" style="background-color:  rgb(59, 59, 58) ; "
            onclick="saveAsDraftDialog()" value="Save As Draft"> &nbsp; -->
        <input type="submit" class="btn text-white mt-5" style="background-color: rgb(210, 132, 30) ; "
            onclick="saveAndOpenDialog()" value="SAVE CHANGES"> &nbsp;
        <input type="submit" class="btn text-white mt-5" style="background-color:  rgb(59, 59, 58) ; "
            onclick="cancelDialog()" value="Cancel">
            
          </div>
        </div>
        <div class="col-md-4"></div>
        <div class="col-md-4"></div>
      </div>
      
    </form>

    <div class="modal fade" id="newvendor">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Vendor</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalVendor">

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="validationCustom01">Title</label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <select name="title" id="title" class="form-control text-dark bg-light">
                      <option value="Mr">Mr</option>
                      <option value="Mrs">Mrs</option>
                      <option value="Miss">Miss</option>
                      <option value="Ms">Ms</option>
                    </select>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="fname">First name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="fname" name="firstname" required>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="lname">Last name</label>
                    <label id="vdisplayname" name = "vdisplayname" hidden></label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="lname" name="lastname">
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="company">Company Name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="vcompany" name="vcompany_name">
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="email">Email</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="email" class="form-control text-dark bg-light" id="vemail" name="vemail" placeholder="example@gmail.com">    
                  </div>              
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="email">Vendor Phone</label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="vw_mobile" placeholder="Work Number" maxlength="10" name="vw_mobile">
                  </div>        
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="vp_mobile" placeholder="Personal Number" maxlength="10" name="vp_mobile">
                  </div>          
                </div>

           
                <hr>
                <center><h4 class="text-uppercase mb-3"><b>Other Details</b></h4></center>

                <div class="row mt-5">
                  <div class="col-md-3 mt-2">
                    <label for="wsite">Website</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="wsite" placeholder="www.example.com" name="website">
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="vskype">Skype name/Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="vskype" name="vskype">
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_desg">Designation</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="v_desg" name="v_desg">
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_dpt">Department</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="v_dpt" name="v_dpt">
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_gsttype" style="color:rgb(190, 88, 88);">GST Treatment *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control text-dark bg-light" id="v_gsttype" name="v_gsttype" required>
                      <option selected disabled value="">Choose..</option>
                      <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                      <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                      <option value="unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                      <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                      <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                      <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                      <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                      <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% eqaulity in creating business units in special economic zone)</option>
                    </select>
                  </div>       
                </div>

                <div class="row gstrow d-none">
                  <div class="col-md-3 mt-2">
                    <label id="glbl" style="color:rgb(190, 88, 88);">GSTIN/UIN *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="v_gstin" name="v_gstin" placeholder="29APPCK7465F1Z1">
                    <label id="gst_label"></label>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_pan">PAN Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="v_pan" name="v_pan" placeholder="APPCK7465F">
                    <label id="pan_label"></label>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="" style="color: rgb(190, 88, 88);">Source of Supply *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control text-dark bg-light" id="v_srcsupply" name="v_sourceofsupply">
                      <option value="Nill"></option>
                      <option value="[AN] Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                      <option value="[AD] Andhra Predhesh">[AD] Andhra Predhesh</option>
                      <option value="[AR] Arunachal Predesh">[AR] Arunachal Predesh</option>
                      <option value="[AS] Assam">[AS] Assam</option>
                      <option value="[BR] Bihar">[BR] Bihar</option>
                      <option value="[CH] Chandigarh">[CH] Chandigarh</option>
                      <option value="[CG] Chhattisgarh">[CG] Chhattisgarh</option>
                      <option value="[DNH] Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                      <option value="[DD] Damn anad Diu">[DD] Damn anad Diu</option>
                      <option value="[DL] Delhi">[DL] Delhi</option>
                      <option value="[GA] Goa">[GA] Goa</option>
                      <option value="[GJ] Gujarat">[GJ] Gujarat</option>
                      <option value="[HR] Haryana">[HR] Haryana</option>
                      <option value="[HP] Himachal Predesh">[HP] Himachal Predesh</option>
                      <option value="[JK] Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                      <option value="[JH] Jharkhand">[JH] Jharkhand</option>
                      <option value="[KA] Karnataka">[KA] Karnataka</option>
                      <option value="[KL] Kerala">[KL] Kerala</option>
                      <option value="[LA] Ladakh">[LA] Ladakh</option>
                      <option value="[LD] Lakshadweep">[LD] Lakshadweep</option>
                      <option value="[MP] Madhya Predesh">[MP] Madhya Predesh</option>
                      <option value="[MH] Maharashtra">[MH] Maharashtra</option>
                      <option value="[MN] Manipur">[MN] Manipur</option>
                      <option value="[ML] Meghalaya">[ML] Meghalaya</option>
                      <option value="[MZ] Mizoram">[MZ] Mizoram</option>
                      <option value="[NL] Nagaland">[NL] Nagaland</option>
                      <option value="[OD] Odisha">[OD] Odisha</option>
                      <option value="[PY] Puducherry">[PY] Puducherry</option>
                      <option value="[PB] Punjab">[PB] Punjab</option>
                      <option value="[RJ] Rajasthan">[RJ] Rajasthan</option>
                      <option value="[SK] Sikkim">[SK] Sikkim</option>
                      <option value="[TN] Tamil Nadu">[TN] Tamil Nadu</option>
                      <option value="[TS] Telangana">[TS] Telangana</option>
                      <option value="[TR] Tripura">[TR] Tripura</option>
                      <option value="[UP] Uttar Predesh">[UP] Uttar Predesh</option>
                      <option value="[UK] Uttarakhand">[UK] Uttarakhand</option>
                      <option value="[WB] West Bengal">[WB] West Bengal</option>
                      <option value="[OT] Other Territory">[OT] Other Territory</option>
                    </select>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_curn">Currency </label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <select class="form-control text-dark bg-light" id="v_curn" name="v_curn" required>
                      <option selected disabled value="">Choose..</option>
                      <option value="INR">INR</option>
                    </select>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_open">Opening Balance</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="v_open" name="v_open">
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_terms">Payment Terms</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <select class="form-control text-dark bg-light" id="v_terms" name="v_terms" required>
                        <option value="30">NET 30</option>
                       
                        <option value="60">NET 60</option>
                        
                        
                        <option value="recpt">Due on receipt</option>
                        {% for p in payments %}
                        <option value="{{p.Days}}">{{p.Terms}}</option>
                        {% endfor %}
                      </select>                
                      <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal">+</a>   
                    </div>
                  </div>       
                </div>

                <hr>

                <div class="row">
                  <div class="col-md-6 mt-5 text-center text-uppercase">
                    <h4 class="mb-0">Billing Address</h4>
                  </div>
                  <div class="col-md-6 mt-5">
                    <h4 class="mb-0 text-center text-uppercase">Shipping Address</h4>
                  </div>
                </div>
                <div class="row mt-2 m-0 p-0 mb-2">
                  <div class="col-md-9"> </div>
                  <div class="col-md-3 text-right  m-0 p-0">
                    <input type="checkbox" onclick="addressSame()" id="vokay" name="vokay">
                    <label for="vokay" style="color: #909091;">Same As Billing Address</label>
                  </div>
                </div>

                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="vstreet">Street</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control street text-dark bg-light" id="vstreet" name="vstreet"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="vsstreet">Street</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control street text-dark bg-light" id="vsstreet" name="vsstreet"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="vcity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vcity" name="vcity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                  <div class="col-md-1">
                    <label for="vscity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vscity" name="vscity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="vstate">State</label>
                  </div>
                  <div class="col-md-4">
                    <select type="text" class="form-control text-dark bg-light" id="vstate" name="vstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>
                  <div class="col-md-1"></div>
  
                  <div class="col-md-1">
                    <label for="vsstate">State</label>
                  </div>
                  <div class="col-md-4 ">
                    <select type="text" class="form-control text-dark bg-light" id="vsstate" name="vsstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>

                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="vcountry">Country</label>
                  </div>
                  <div class="col-md-4 ">
                    <input type="text" class="form-control text-dark bg-light" id="vcountry" name="vcountry" placeholder="Country">  
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="vscountry">Country</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vscountry"  name="vscountry" placeholder="Country">
                  </div>
                  <div class="col-md-1 "></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="vpincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vpincode" name="vpincode" maxlength="6" placeholder="PIN Code"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="vspincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vspincode" name="vspincode" maxlength="6" placeholder="PIN Code">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="vphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vphone" name="vphone" maxlength="6" placeholder="Phone"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="vsphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vsphone" name="vsphone" maxlength="6" placeholder="Phone">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="vfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vfax" name="vfax" maxlength="6" placeholder="FAX"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="vsfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="vsfax" name="vsfax" maxlength="6" placeholder="FAX">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row">
                    <div class="col-md-6">
                      <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                      <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                      <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                    </div>
                </div>
                <div class="row">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="vendorSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
                  </div>
              </div>
          </div>
      </div>  
    </div>  
<!-- repeat modal -->


<div class="modal fade" id="newrepeat">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
      <div class="modal-header " style="background: rgb(32, 35, 37);">
          <h3 class="m-3 text-uppercase">Add Repeat</h3>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3">
          <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalRepeat">
            <div class="row mt-2">
              <div class="col-md-2 mt-2"></div>
              <div class="col-md-4 mt-2">
                
              </div>

            </div>


            <div class="row mt-2">
              <div class="col-md-2 mt-2">
                <center><label for="termname" style="color: rgb(190, 88, 88);">Add Repeat*</label></center>
              </div>

              <div class="col-md-4 mt-2">
                <input type="text" class="form-control text-dark bg-light" id="repeats_input" name="repeats_input" required>      
              </div>

             

            </div>
            
            <div class="row mt-5">
              <div class="col-md-4"></div>
              <div class="col-md-4">
                <div class="d-flex">
                  <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                  type="submit" data-dismiss="modal" id="RepeatSave">Save
                  </button> 
                  

                  <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                    data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">Cancel</span>
                  </button>
                </div>
              </div>
              <div class="col-md-4"></div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>  
</div>  

    <!-- payment modal -->


    <div class="modal fade" id="newpayment">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">Add Payment Term</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalPayment">
                <div class="row mt-2">
                  <div class="col-md-2 mt-2"></div>
                  <div class="col-md-4 mt-2">
                    <center><label for="termname" style="color: rgb(190, 88, 88);">Term Name *</label></center>
                  </div>

                  <div class="col-md-4 mt-2">
                    <center><label for="termdays" style="color: rgb(190, 88, 88);">Number of Days *</label></center>
                  </div>
                  <div class="col-md-2 mt-2"></div>
                </div>


                <div class="row mt-2">
                  <div class="col-md-2 mt-2"></div>

                  <div class="col-md-4 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="term_name" name="term_name" required>      
                  </div>

                  <div class="col-md-4 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="term_days" name="term_days" required>
                  </div>
                  <div class="col-md-2 mt-2"></div>

                </div>
                
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="paySave">Save
                      </button> 
                      

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>  

    <!-- customer modal -->


    <div class="modal fade" id="newcustomer">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Customer</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalCustomer">
        
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="">Customer Type</label><br>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="business" name="radioCust" value="Business" >
                        <label for="option1">Business</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="individual" name="radioCust" value="Individual" >
                        <label for="option2">Individual</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-3">
                    <label for="ctitle">Title</label>
                  </div>
                  <div class="col-md-3">
                    <select name="ctitle" id="ctitle" class="form-control text-dark bg-light">
                      <option value="Mr." selected>Mr.</option>
                      <option value="Mrs.">Mrs.</option>
                      <option value="Ms.">Ms.</option>
                      <option value="Miss.">Miss.</option>
                      <option value="Dr.">Dr.</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cfname">First name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cfname" name="cfirstname" required>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="clname">Last name</label>
                    <label id="cdisplayname" name = "cdisplayname" hidden></label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="clname" name="clastname">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="ccompany">Company Name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="ccompany" name="ccompany_name">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cemail">Customer Email</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="email" class="form-control text-dark bg-light" id="cemail" name="cemail" placeholder="example@gmail.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$">    
                  </div>              
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="email">Customer Phone</label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cw_mobile" placeholder="Work Number" maxlength="10" name="cw_mobile">
                  </div>        
                  <div class="col-md-3 mt-2">
                    <input type="text" class="form-control" id="cp_mobile" placeholder="Personal Number" maxlength="10" name="cp_mobile">
                  </div>          
                </div>

           
                <hr>
                <center><h4 class="text-uppercase mb-3"><b>Other Details</b></h4></center>
                <div class="row mt-5">
                  <div class="col-md-3 mt-2">
                    <label for="facebook">Facebook</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="facebook" placeholder="www.example.com" name="facebook">
                  </div>       
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="twitter">Twitter</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light " id="twitter" placeholder="www.example.com" name="twitter">
                  </div>       
                </div>


                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="website">Website</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="website" placeholder="www.example.com" name="website">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cskype">Skype name/Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="cskype" name="cskype">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_desg">Designation</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_desg" name="c_desg">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_dpt">Department</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_dpt" name="c_dpt">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_gsttype" style="color:rgb(190, 88, 88);">GST Treatment *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control text-dark bg-light" id="c_gsttype" name="c_gsttype" required>
                      <option value="value" selected>Select a Gst Treatment</option>
                      <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                      <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">Registered Business-Composition Business that is registered under the Composition scheme in GST</option>
                      <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                      <option value="Consumer- A customer who is a regular Consumer">Consumer- A customer who is a regular Consumer</option>
                      <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                      <option value="Special Economic Zone">Special Economic Zone</option>
                    </select>
                  </div>       
                </div>

                <!-- <div class="row gstrow d-none">
                  <div class="col-md-3 mt-2">
                    <label id="glbl" style="color:rgb(190, 88, 88);">GSTIN/UIN *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control" id="v_gstin" name="v_gstin" placeholder="29APPCK7465F1Z1">
                    <label id="gst_label"></label>
                  </div>       
                </div>

                <div class="row">
                  <div class="col-md-3 mt-2">
                    <label for="v_pan">PAN Number</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control" id="v_pan" name="v_pan" placeholder="APPCK7465F">
                    <label id="pan_label"></label>
                  </div>       
                </div> -->

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="" style="color: rgb(190, 88, 88);">Place of Supply *</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <select class="form-control text-dark bg-light" id="placesupply" name="placesupply">
                      <option value="Nill"></option>
                      <option value="[AN] Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                      <option value="[AD] Andhra Predhesh">[AD] Andhra Predhesh</option>
                      <option value="[AR] Arunachal Predesh">[AR] Arunachal Predesh</option>
                      <option value="[AS] Assam">[AS] Assam</option>
                      <option value="[BR] Bihar">[BR] Bihar</option>
                      <option value="[CH] Chandigarh">[CH] Chandigarh</option>
                      <option value="[CG] Chhattisgarh">[CG] Chhattisgarh</option>
                      <option value="[DNH] Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                      <option value="[DD] Damn anad Diu">[DD] Damn anad Diu</option>
                      <option value="[DL] Delhi">[DL] Delhi</option>
                      <option value="[GA] Goa">[GA] Goa</option>
                      <option value="[GJ] Gujarat">[GJ] Gujarat</option>
                      <option value="[HR] Haryana">[HR] Haryana</option>
                      <option value="[HP] Himachal Predesh">[HP] Himachal Predesh</option>
                      <option value="[JK] Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                      <option value="[JH] Jharkhand">[JH] Jharkhand</option>
                      <option value="[KA] Karnataka">[KA] Karnataka</option>
                      <option value="[KL] Kerala">[KL] Kerala</option>
                      <option value="[LA] Ladakh">[LA] Ladakh</option>
                      <option value="[LD] Lakshadweep">[LD] Lakshadweep</option>
                      <option value="[MP] Madhya Predesh">[MP] Madhya Predesh</option>
                      <option value="[MH] Maharashtra">[MH] Maharashtra</option>
                      <option value="[MN] Manipur">[MN] Manipur</option>
                      <option value="[ML] Meghalaya">[ML] Meghalaya</option>
                      <option value="[MZ] Mizoram">[MZ] Mizoram</option>
                      <option value="[NL] Nagaland">[NL] Nagaland</option>
                      <option value="[OD] Odisha">[OD] Odisha</option>
                      <option value="[PY] Puducherry">[PY] Puducherry</option>
                      <option value="[PB] Punjab">[PB] Punjab</option>
                      <option value="[RJ] Rajasthan">[RJ] Rajasthan</option>
                      <option value="[SK] Sikkim">[SK] Sikkim</option>
                      <option value="[TN] Tamil Nadu">[TN] Tamil Nadu</option>
                      <option value="[TS] Telangana">[TS] Telangana</option>
                      <option value="[TR] Tripura">[TR] Tripura</option>
                      <option value="[UP] Uttar Predesh">[UP] Uttar Predesh</option>
                      <option value="[UK] Uttarakhand">[UK] Uttarakhand</option>
                      <option value="[WB] West Bengal">[WB] West Bengal</option>
                      <option value="[OT] Other Territory">[OT] Other Territory</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference* </label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="tax" name="radioCust1" value="Taxable" >
                        <label for="option1">Taxable</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="taxe" name="radioCust1" value="Tax-exempt" >
                        <label for="option2">Tax-exempt</label>
                      </div>
                    </div>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_curn">Currency </label>
                  </div>
                  <div class="col-md-3 mt-2">
                    <select class="form-control text-dark bg-light" id="c_curn" name="c_curn" required>
                      <option selected disabled value="">Choose..</option>
                      <option value="INR">INR</option>
                    </select>
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_open">Opening Balance</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="c_open" name="c_open">
                  </div>       
                </div>

                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="c_terms">Payment Terms</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <div class="d-flex">
                      <select class="form-control text-dark bg-light" id="c_terms" name="c_terms" required>
                       <option value="30">NET 30</option>
                        
                        <option value="60">NET 60</option>
                       
                        
                        <option value="recpt">Due on receipt</option>
                        {% for p in payments %}
                        <option value="{{p.Days}}">{{p.Terms}}</option>
                        {% endfor %}
                      </select>                
                      <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal">+</a>   
                    </div>
                  </div>       
                </div>
                

                <hr>

                <div class="row mt-2">
                  <div class="col-md-6 mt-5 text-center text-uppercase">
                    <h4 class="mb-0">Billing Address</h4>
                  </div>
                  <div class="col-md-6 mt-5">
                    <h4 class="mb-0 text-center text-uppercase">Shipping Address</h4>
                  </div>
                </div>
                <div class="row mt-2 m-0 p-0 mb-2">
                  <div class="col-md-9"> </div>
                  <div class="col-md-3 text-right  m-0 p-0">
                    <input type="checkbox" onclick="addressSame()" id="csokay" name="csokay">
                    <label for="csokay" style="color: #909091;">Same As Billing Address</label>
                  </div>
                </div>

                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="cstreet1">Address 1</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control street text-dark bg-light" id="cstreet1" name="cstreet1"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csstreet1">Address 1</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control street text-dark bg-light" id="csstreet1" name="csstreet1"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>
                <div class="row mt-5">
                  <div class="col-md-1">
                    <label for="cstreet2">Address 2</label>
                  </div>
                  <div class="col-md-4">
                    <textarea class="form-control street text-dark bg-light" id="cstreet2" name="cstreet2"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csstreet2">Address 2</label>
                  </div>
                  <div class="col-md-4 ">
                    <textarea class="form-control street text-dark bg-light" id="csstreet2" name="csstreet2"></textarea>
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="ccity" name="ccity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                  <div class="col-md-1">
                    <label for="cscity">City</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cscity" name="cscity" placeholder="City">  
                  </div>
                  <div class="col-md-1">
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="cstate">State</label>
                  </div>
                  <div class="col-md-4">
                    <select type="text" class="form-control text-dark bg-light" id="cstate" name="cstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads</option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>
                  <div class="col-md-1"></div>
  
                  <div class="col-md-1">
                    <label for="csstate">State</label>
                  </div>
                  <div class="col-md-4 ">
                    <select type="text" class="form-control text-dark bg-light" id="csstate" name="csstate">
                      <option value="" selected>Choose</option>
                      <option value="None Of This">None Of This</option>
                      <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                      </option>
                      <option value="Andhra Predhesh">Andhra Predhesh</option>
                      <option value="Arunachal Predesh">Arunachal Predesh</option>
                      <option value="Assam">Assam</option>
                      <option value="Bihar">Bihar</option>
                      <option value="Chandigarh">Chandigarh</option>
                      <option value="Chhattisgarh">Chhattisgarh</option>
                      <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                      <option value="Damn anad Diu">Damn anad Diu</option>
                      <option value="Delhi">Delhi</option>
                      <option value="Goa">Goa</option>
                      <option value="Gujarat">Gujarat</option>
                      <option value="Haryana">Haryana</option>
                      <option value="Himachal Predesh">Himachal Predesh</option>
                      <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                      <option value="Jharkhand">Jharkhand</option>
                      <option value="Karnataka">Karnataka</option>
                      <option value="Kerala">Kerala</option>
                      <option value="Ladakh">Ladakh</option>
                      <option value="Lakshadweep">Lakshadweep</option>
                      <option value="Madhya Predesh">Madhya Predesh</option>
                      <option value="Maharashtra">Maharashtra</option>
                      <option value="Manipur">Manipur</option>
                      <option value="Meghalaya">Meghalaya</option>
                      <option value="Mizoram">Mizoram</option>
                      <option value="Nagaland">Nagaland</option>
                      <option value="Odisha">Odisha</option>
                      <option value="Puducherry">Puducherry</option>
                      <option value="Punjab">Punjab</option>
                      <option value="Rajasthan">Rajasthan</option>
                      <option value="Sikkim">Sikkim</option>
                      <option value="Tamil Nadu">Tamil Nadu</option>
                      <option value="Telangana">Telangana</option>
                      <option value="Tripura">Tripura</option>
                      <option value="Uttar Predesh">Uttar Predesh</option>
                      <option value="Uttarakhand">Uttarakhand</option>
                      <option value="West Bengal">West Bengal</option>
                      <option value="Other Territory">Other Territory</option>
                    </select>
                  </div>

                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                  <div class="col-md-1">
                    <label for="ccountry">Country</label>
                  </div>
                  <div class="col-md-4 ">
                    <input type="text" class="form-control text-dark bg-light" id="ccountry" name="ccountry" placeholder="Country">  
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cscountry">Country</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cscountry"  name="cscountry" placeholder="Country">
                  </div>
                  <div class="col-md-1 "></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cpincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cpincode" name="cpincode" maxlength="6" placeholder="PIN Code"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="cspincode">Pincode</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cspincode" name="cspincode" maxlength="6" placeholder="PIN Code">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cphone" name="cphone" placeholder="Phone"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csphone">Phone</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="csphone" name="csphone" placeholder="Phone">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">

                  <div class="col-md-1">
                    <label for="cfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="cfax" name="cfax" placeholder="FAX"> 
                  </div>
                  <div class="col-md-1"></div>

                  <div class="col-md-1">
                    <label for="csfax">Fax</label>
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control text-dark bg-light" id="csfax" name="csfax" placeholder="FAX">  
                  </div>
                  <div class="col-md-1"></div>

                </div>

                <div class="row mt-2">
                    <div class="col-md-6">
                      <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                      <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                      <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                    </div>
                </div>
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="customerSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
                  </div>
              </div>
          </div>
      </div>  
    </div>  

    <!-- item modal -->

    <div class="modal fade" id="newitem">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Item</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalItem">

                <div class="row mt-2">
                  <div class="col-md-4 mr-0">
                    <label class="col-form-label col-sm-2 p-0">Type <i class="fa fa-question-circle"></i></label>
                  </div>
                  <div class="col-md-5 ml-0 d-flex">
                    <div class="radio_opt mx-5 ">
                      <input type="radio" id="item_type1" name="radioOption" value="Goods" >
                      <label for="option1">Goods</label>
                    </div>
                    <div class="radio_opt mx-5 ">
                      <input type="radio" id="item_type2" name="radioOption" value="Services" >
                      <label for="option2">Services</label>
                    </div>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3">
                    <label for="name" style="color: rgb(190, 88, 88);">Name *</label>
                  </div>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-dark bg-light" id="item_name" name="item_name" required>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3">
                    <label for="name" style="color: rgb(190, 88, 88);">HSN</label>
                  </div>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-dark bg-light" id="HSN" name="HSN" required>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-3 ">
                    <label for="units">Unit</label>
                  </div>
                  <div class="col-md-6">
                    <div class="d-flex">
                      <select class="form-control text-dark bg-light" id="item_units" name="item_units" required>
                        <option value="">Select Unit</option>
                        {% for u in units %}
                        <option value="{{u.id}}">{{u.unit}}</option>
                        {% endfor %}
                      </select>                
                      <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newunit" data-toggle="modal">+</a>  
                    </div>
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-4 ">
                    <label for="c_tax" style="color: rgb(190, 88, 88);">Tax Preference * </label>
                  </div>
                  <div class="col-md-5">
                    <div class="d-flex">
                      <div class="radio_opt mx-5 mt-2">
                        <input type="radio" id="item-tax1" name="radioOption1" value="Taxable" >
                        <label for="option1">Taxable</label>
                      </div>
                      <div class="radio_opt mx-4 mt-2">
                        <input type="radio" id="item-tax2" name="radioOption1" value="Tax-exempt" >
                        <label for="option2">Tax-exempt</label>
                      </div>
                    </div>
                  </div>       
                </div>

                <div class="row mt-2 mb-4 d-none inter-intra" >
                  <div class="col-md-3">
                    <label for="intra">Intra-State TAX</label>
                  </div>
                  <div class="col-md-3">
                    <select name="intra" class="form-control text-dark bg-light" id="intra">
                      <option value="">Select GST</option>

                      <option value="GST0[0%]">GST0[0%]</option>
                      <option value="GST5[5%]">GST5[5%]</option>
                      <option value="GST12[12%]">GST12[12%]</option>
                      <option value="GST18[18%]">GST18[18%]</option>
                      <option value="GST28[28%]">GST28[28%]</option>
                    </select>             
                  </div>

                  
                  <div class="col-md-2">
                    <label for="inter">Inter-State TAX</label>
                  </div>
                  <div class="col-md-3">
                    <select name="inter" class="form-control text-dark bg-light" id="inter">
                      <option value="">Select GST</option>

                      <option value="IGST0[0%]">IGST0[0%]</option>
                      <option value="IGST5[5%]">IGST5[5%]</option>
                      <option value="IGST12[12%]">IGST12[12%]</option>
                      <option value="IGST18[18%]">IGST18[18%]]</option>
                      <option value="IGST28[28%]">IGST28[28%]</option>
                    </select>               
                  </div>
                  <div class="col-md-1"></div>

                </div>
                
                <hr>

                <div class="row mt-5 text-center">
                  <div class="col-md-6 d-flex text-center">
                    <input  type="checkbox" name="selling" checked class="mx-2 my-0">
                    <h6 class="m-0">Selling Information</h6>
                  </div>
                  <div class="col-md-6 d-flex text-center">
                    <input  type="checkbox" name="purchase" checked class="mx-2 my-0">
                    <h6 class="m-0">Purchase Information</h6>
                  </div>
                </div>
                
                <div class="row mt-4">
                  <div class="col-md-2">
                    <label for="sell_price">Selling Price *</label>
                  </div>
                  <div class="col-md-4">
                    <div class="input-group mb-2">
                      <div class="input-group-prepend">
                        <div class="input-group-text">INR</div>
                      </div>
                      <input required type="text" class="form-control text-dark bg-light" name="sell_price" id="sell_price">
                    </div>                  
                  </div>

                  <div class="col-md-2">
                    <label for="cost_price">Cost Price *</label>
                  </div>
                  <div class="col-md-4 ">
                    <div class="input-group mb-2">
                      <div class="input-group-prepend">
                        <div class="input-group-text">INR</div>
                      </div>
                      <input required type="text" class="form-control text-dark bg-light" name="cost_price" id="cost_price">
                    </div>
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-2">
                    <label for="vcity">Account</label>
                  </div>
                  <div class="col-md-4">
                    <select name="sell_acc" id="sell_acc" class="form-control text-dark bg-light">
                      <option value="">Select Account</option>
       
                      {% for sale in sales_type %}
                        <option value="" disabled class="btn btn-dark text-white"><b>{{ sale }}</b></option>
                        {% for s in sales %}
                          {% if s.Account_type == sale %}
                            <option value="{{s.id}}">{{ s.Account_name }}</option>
                          {% endif %}
                        {% endfor %}
                      {% endfor %}
                    </select> 
                  </div>
                  <div class="col-md-2">
                    <label for="cost_acc">Account</label>
                  </div>
                  <div class="col-md-4">
                    <select name="cost_acc" class="form-control text-dark bg-light" id="cost_acc">
                      <option value="">Select Account</option>


                      {% for purch in purchase_type %}
                        <option value="" disabled class="btn btn-dark text-white"><b>{{ purch }}</b></option>
                        {% for p in purchase %}
                          {% if p.Account_type == purch %}
                            <option value="{{p.id}}">{{ p.Account_name }}</option>
                          {% endif %}
                        {% endfor %}
                      {% endfor %}

                    </select> 
                  </div>
                </div>

                <div class="row mt-2">
                  <div class="col-md-2">
                    <label for="sell_desc">Description</label>
                  </div>
                  <div class="col-md-4">
                    <input  type="text" name="sell_desc" class="form-control text-dark bg-light"  id="sell_desc">
                  </div>
  
                  <div class="col-md-2">
                    <label for="cost_desc">Description</label>
                  </div>
                  <div class="col-md-4 ">
                    <input  type="text" name="cost_desc" class="form-control text-dark bg-light"  id="cost_desc">
                  </div>

                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                      <input type="checkbox" value="" id="invalidCheck" name="invalidCheck" required>
                      <label for="invalidCheck" style="color: #909091;">Agree to terms and conditions</label>
                      <div class="invalid-feedback text-warning" >You must agree before submitting.</div>
                    </div>
                </div>
                <div class="row">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="itemSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
                  </div>
              </div>
          </div>
      </div>  
    </div>  


    <!-- unit modal -->

    <div class="modal fade" id="newunit">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">Add Unit</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalUnit">
                <div class="row mt-2">
                  <div class="col-md-3 mt-2"></div>
                  <div class="col-md-1 mt-2">
                    <label for="unit" style="color: rgb(190, 88, 88);">Unit</label>
                  </div>

                  <div class="col-md-4 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="unit" name="unit" required>
                  </div>
                  <div class="col-md-4 mt-2"></div>
                </div>
                
                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="unitSave">Save
                      </button> 
                      

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>  


    <!-- account modal -->

    <!-- <div class="modal fade" id="newaccount">
      <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
          <div class="modal-header " style="background: rgb(32, 35, 37);">
              <h3 class="m-3 text-uppercase">New Account</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3">
              <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalAccount">
        
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="">Account Type</label><br>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="acct_type" name="acct_type" required>
                  </div>
                </div>
                
                <div class="row mt-2">
                  <div class="col-md-3 mt-2">
                    <label for="cfname">Account name</label>
                  </div>
                  <div class="col-md-6 mt-2">
                    <input type="text" class="form-control text-dark bg-light" id="acct_name" name="acct_name" required>
                  </div>
                </div>            

                <div class="row mt-5">
                  <div class="col-md-4"></div>
                  <div class="col-md-4">
                    <div class="d-flex">
                      <button class="btn save_btn rounded-pill text-grey w-50 my-4 mx-3"
                      type="submit" data-dismiss="modal" id="accountSave">Submit
                      </button> 

                      <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-4" 
                        data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">Cancel</span>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-4"></div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>  
    </div>   -->

    <!-- end of modal -->



    
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
// document.getElementById("cancelButton").addEventListener("click", function() {
//   document.getElementById("myForm").reset(); 
//   location.reload(); 
// });
  
function toggleDateInput() {
      var checkbox = document.getElementById("never-expire-checkbox");
      var dateInput = document.getElementById("date2");
      
      if (checkbox.checked) {
          dateInput.disabled = true;
         
          $('#date2').val('');
          $("#terms").val("recpt");
      } 
      else {
          dateInput.disabled = false;
      }
  }

  $(document).ready(function() {
    $('#terms').change(function() {
      var va = $(this).val();
      var checkbox = $('#never-expire-checkbox')[0];
      if (va == 'recpt'){
        checkbox.checked = true;
        $('#date2')[0].disabled = true;
      }
      else{
        checkbox.checked = false;
        $('#date2').disabled = false;
      }
      });
  });

  $(document).ready(function() {

        var name = $("#vendor").val();
        var na = name.split(' ')[0];
        $.ajax({

            url: "{% url 'get_vendordet' %}", 

            data: { 
                    // fname : na[0],
                    // lname : na[1],
                    id :na,
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {

              $("#email_row").removeClass('d-none');
                $("#email_row").addClass('d-flex');
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $("#gst_trt_row").removeClass('d-none');
                $("#gst_trt_row").addClass('d-flex');

                $('#email_inp').val(data.vendor_email);
                $('#gstin_inp').val(data.gst_number);
                $('#gst_trt_inp').val(data.gst_treatment);
                $("#vsrcofsupply").val(data.source_supply.replace('-',' ')).attr("selected","selected");
                $('#gstin_inp').val(data.gstin); 

                if( data.gst_treatment == 'Registered Business-Regular Business that is registered under GST'){
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $('#gstin_inp').val(data.gst_number);

              }
              else if( data.gst_treatment == 'Registered Business-Composition Business that is registered under the Composition scheme in GST'){
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $('#gstin_inp').val(data.gst_number);
              }
              else if( data.gst_treatment == 'Overseas- Persons with who you do import or exports of supplies outside india'){
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $('#gstin_inp').val(data.gst_number);
              }
              
              else{
                $("#gstin_row").addClass('d-none');
              }

            }
        });

});
  
$(document).ready(function() {
    $('#vendor').change(function() {
      var name = $("#vendor").val();
        var na = name.split(' ')[0];
        // console.log(name);
        $.ajax({

            url: "{% url 'get_vendordet' %}", 

            data: { 
                    // fname : na[0],
                    // lname : na[1],
                    id :na,
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {
                $("#email_row").removeClass('d-none');
                $("#email_row").addClass('d-flex');
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $("#gst_trt_row").removeClass('d-none');
                $("#gst_trt_row").addClass('d-flex');

                $('#email_inp').val(data.vendor_email);
                $('#gstin_inp').val(data.gst_number);
                $('#gst_trt_inp').val(data.gst_treatment);
                $("#vsrcofsupply").val(data.source_supply.replace('-',' ')).attr("selected","selected");
                $('#gstin_inp').val(data.gst_number); 

                if( data.gst_treatment == 'Registered Business-Regular Business that is registered under GST'){
                 $("#gstin_row").removeClass('d-none');
                 $("#gstin_row").addClass('d-flex');
                 $('#gstin_inp').val(data.gst_number);

              }
              else if( data.gst_treatment == 'Registered Business-Composition Business that is registered under the Composition scheme in GST'){
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $('#gstin_inp').val(data.gst_number);
              }
              else if( data.gst_treatment == 'Overseas- Persons with who you do import or exports of supplies outside india'){
                $("#gstin_row").removeClass('d-none');
                $("#gstin_row").addClass('d-flex');
                $('#gstin_inp').val(data.gst_number);
              }
              
              else{
                $("#gstin_row").addClass('d-none');
              }

            }
        });
    
    });
});

$(document).ready(function() {

var name = $("#customer").val();
var na = name.split(' ')[0];
$.ajax({

    url: "{% url 'get_customerdet' %}", 

    data: { 
            // name : na[1]+ " " + na[2] + " "+ na[3],
            id : na,
            csrfmiddlewaretoken: '{{ csrf_token }}' 
        },

    type : 'POST',

    success: function(data) {
      console.log('na');
      $("#cemail_row").removeClass('d-none');
      $("#cemail_row").addClass('d-flex');
      
      $("#cgst_trt_row").removeClass('d-none');
      $("#cgst_trt_row").addClass('d-flex');
      $('#cemail_inp').val(data.customer_email);
      $('#srcofsupply').val(data.cust_place_supply);
      $('#cgst_trt_inp').val(data.gst_treatment);
      $('#cgstin_inp').val(data.gstin); 
      if( data.gst_treatment == 'Registered Business-Regular Business that is registered under GST'){
        $("#cgstin_row").removeClass('d-none');
        $("#cgstin_row").addClass('d-flex');
        $('#cgstin_inp').val(data.gstin);

      }
      else if( data.gst_treatment == 'Registered Business-Composition Business that is registered under the Composition scheme in GST'){
        $("#cgstin_row").removeClass('d-none');
        $("#cgstin_row").addClass('d-flex');
        $('#cgstin_inp').val(data.gstin);
      }
      else if( data.gst_treatment == 'Overseas- Persons with who you do import or exports of supplies outside india'){
        $("#cgstin_row").removeClass('d-none');
        $("#cgstin_row").addClass('d-flex');
        $('#cgstin_inp').val(data.gstin);
      }
      
      else{
        $("#cgstin_row").addClass('d-none');
      }

        // gst or igst in tax

      $("#cust_state").val(data.state);
      srcofsupply()
    }
    
});

});

function srcofsupply(){ debugger
      $(".selecttax").removeClass('d-flex');
      $(".selecttax").addClass('d-none');
      var custsrcofsupply = $("#srcofsupply").val().split('-')[1];  
      if(custsrcofsupply == $("#company_state").val())
      {
        $(".tax2").removeClass('d-flex');
        $(".tax2").addClass('d-none');
        $(".tax1").removeClass('d-none');
        $(".tax1").addClass('d-flex'); 

        $("#cgst1").removeClass('d-none');
        $("#cgst1").addClass('d-flex');
        $("#sgst1").removeClass('d-none');
        $("#sgst1").addClass('d-flex');

        $("#igst1").removeClass('d-flex');
        $("#igst1").addClass('d-none');

      }
      else{ 

        $(".tax2").removeClass('d-none');
        $(".tax2").addClass('d-flex');
        $(".tax1").removeClass('d-flex');
        $(".tax1").addClass('d-none'); 

        $("#igst1").removeClass('d-none');
        $("#igst1").addClass('d-flex');

        $("#cgst1").removeClass('d-flex');
        $("#cgst1").addClass('d-none');
        $("#sgst1").removeClass('d-flex');
        $("#sgst1").addClass('d-none');
      }
     
  }
 function itemchange(){
  
  var row_count = $("#items-table-body tr").length;
    var tax_tot = 0

    var amount_total = 0;
    var ship = parseFloat($("#addcharge").val());

    for(var i=0; i<row_count;i++){
      var rate = $("#rate"+i).val();
      var qnty = $("#qty" +i).val();
      var amount = rate*qnty;
      var disc = $("#disc" + i).val();

      var tax1 = $("#intra_tax" +i).val();
      var tax2 = $("#inter_tax" +i).val();

      if (tax1 == 0){
        if(tax2 == 0){
          if (disc){
            amount_disc =  amount - disc;
            $("#amount" + i).val(amount_disc);
             
          }

          else{
            $("#amount" +i).val(amount);
           }
          tax = 0;
          tax_tot += tax;
        }
        else{
          if (disc){
            amount_disc =  amount - disc;
            $("#amount" + i).val(amount_disc);
            tax =(amount_disc*(tax2/100));
          }

          else{
            $("#amount" +i).val(amount);
            tax =(amount*(tax2/100));
           }
          
          tax_tot += tax;
          $("#igst").val(tax_tot);
          $("#total_taxamount").val(tax_tot);
        }
      }
      else{
        if (disc){
            amount_disc =  amount - disc;
            $("#amount" + i).val(amount_disc);
            tax =(amount_disc*(tax1/100));
          }

          else{
            $("#amount" +i).val(amount);
            tax =(amount*(tax1/100));
           }
        tax = (amount*(tax1/100));
        tax_tot += tax;
        $("#sgst").val(tax_tot/2);
        $("#cgst").val(tax_tot/2);
        $("#total_taxamount").val(tax_tot);
      }

      if(ship){
        // console.log('yea');
        if (disc){
          amount_disc =  amount - disc;
          $("#amount" + i).val(amount_disc);
          amount_total += amount_disc;
          $("#subtotal").val(amount_total);
          
          $("#grandtotal").val(amount_total+ ship +tax_tot);
        }

        else{
          $("#amount" +i).val(amount);
          amount_total += amount;
          $("#subtotal").val(amount_total);
          $("#grandtotal").val(amount_total+ ship +tax_tot);
        }
      }
      else{

        if (disc){
          amount_disc =  amount - disc;
          $("#amount" +i).val(amount_disc);
          amount_total += amount_disc;
          $("#subtotal").val(amount_total);
        
          $("#grandtotal").val(amount_total+tax_tot);
        }

        else{
          $("#amount" +i).val(amount);
          amount_total += amount;
          $("#subtotal").val(amount_total);
          $("#grandtotal").val(amount_total+tax_tot);
        }
      }
      
    }  
 }

// function srcofsupply(){ debugger
//   $(".selecttax").removeClass('d-none');
//   $(".selecttax").addClass('d-flex');
//   var st = $("#srcofsupply").val().split(" ").slice(1).join(" ").trim();
//   console.log(st)
//   if( st == $("#company_state").val())
//   {
//     $(".tax2").removeClass('d-flex');
//     $(".tax2").addClass('d-none');
//     $(".tax1").removeClass('d-flex');
//     $(".tax1").addClass('d-none');

//     $("#cgst1").removeClass('d-none');
//     $("#cgst1").addClass('d-flex');
//     $("#sgst1").removeClass('d-none');
//     $("#sgst1").addClass('d-flex');

//     $("#igst1").removeClass('d-flex');
//     $("#igst1").addClass('d-none');

//   }
//   else{
//     $(".tax1").removeClass('d-flex');
//     $(".tax1").addClass('d-none');
//     $(".tax2").removeClass('d-flex');
//     $(".tax2").addClass('d-none');

//     $("#igst1").removeClass('d-none');
//     $("#igst1").addClass('d-flex');

//     $("#cgst1").removeClass('d-flex');
//     $("#cgst1").addClass('d-none');
//     $("#sgst1").removeClass('d-flex');
//     $("#sgst1").addClass('d-none');
//   }
//   }

$(document).ready(function() {
    $('#customer').change(function() {

        var name = $("#customer").val();
        var na = name.split(' ')[0];
        console.log(na);
        $.ajax({

            url: "{% url 'get_customerdet' %}", 

            data: { 
                    // name : na[1]+ " " + na[2] + " "+ na[3],
                    id : na,
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {
debugger
              $("#cemail_row").removeClass('d-none');
              $("#cemail_row").addClass('d-flex');
              
              $("#cgst_trt_row").removeClass('d-none');
              $("#cgst_trt_row").addClass('d-flex');
              $('#cemail_inp').val(data.customer_email);
              $('#srcofsupply').val(data.cust_place_supply);
              $('#cgst_trt_inp').val(data.gst_treatment);
              $('#cgstin_inp').val(data.gstin); 

              if( data.gst_treatment == 'Registered Business-Regular Business that is registered under GST'){
                $("#cgstin_row").removeClass('d-none');
                $("#cgstin_row").addClass('d-flex');
                $('#cgstin_inp').val(data.gstin);

              }
              else if( data.gst_treatment == 'Registered Business-Composition Business that is registered under the Composition scheme in GST'){
                $("#cgstin_row").removeClass('d-none');
                $("#cgstin_row").addClass('d-flex');
                $('#cgstin_inp').val(data.gstin);
              }
              else if( data.gst_treatment == 'Overseas- Persons with who you do import or exports of supplies outside india'){
                $("#cgstin_row").removeClass('d-none');
                $("#cgstin_row").addClass('d-flex');
                $('#cgstin_inp').val(data.gstin);
              }
              
              else{
                $("#cgstin_row").addClass('d-none');
              }

                // gst or igst in tax

              $("#cust_state").val(data.state);
              
            }
            
        });
    
    });
});




  $(document).ready(function(){


    $('#add').click(function(){
      var table = document.getElementById("items-table-body");
      var roinc = table.rows.length;

      $('#items-table-body').append(
        
        `<tr id='addr${roinc}' class = 'addr'>
          <td style="width: 20%;">
            <div class="d-flex">
              <select name='item[]' id="item${roinc}" class="form-control item text-dark bg-light" onchange = "showRate(this.id,this.value);">
                <option value="" selected disabled >Select Item</option>
                {% for i in item %}
                      <option value="{{i.id}}">{{i.Name}}</option>
                {% endfor %}
              </select>
            </div>  
          </td>
          <td style="width: 11%;">
            <input type="text" name='HSN[]' id="HSN${roinc}" placeholder='HSN' class="form-control HSN text-dark bg-light" step="0.00" min="0" style = "width:80px;" />
          </td>
         
          <td style="width: 10%;">
            <input type="number" name='qty[]'  placeholder='Qty' id="qty${roinc}"  class="form-control qty text-dark bg-light" step=0 min=0/>
          </td>
          <td style="width: 10%;">
            <input type="text" name='rate[]'  id="rate${roinc}" placeholder='Rate' class="form-control rate text-dark bg-light" style = "width:90px;" />
          </td>
          <td style="width: 15%;">
            <input type="hidden" id="tax_total0" class="form-control mb-2 d-none">
            <input type="text" placeholder="Select TAX" class="form-control selecttax text-dark bg-light" id="selecttax${roinc}"  style = "width:100px;">
            <select name="tax1[]" id="intra_tax${roinc}" class="form-control tax1 d-none mb-2 text-dark bg-light">
                <option id="ta1" value=0 text=" ">Choose GST</option>
                <option value=28 text="{{ cmp1.state }}">28.0% GST(28%)</option>
                <option value=18 text="{{ cmp1.state }}">18.0% GST(18%)</option>
                <option value=12 text="{{ cmp1.state }}">12.0% GST(12%)</option>
                <option value=5 text="{{ cmp1.state }}">05.0% GST(05%)</option>
                <option value=3 text="{{ cmp1.state }}">03.0% GST(03%)</option>
                <option value=0 text="{{ cmp1.state }}">0.0% GST(0%)</option>
            </select>

            <select name="tax2[]" id="inter_tax${roinc}" class="form-control tax2 d-none mb-2 text-dark bg-light">
              <option id="ta5" value=0 text=" " >Choose IGST</option>
              <option value=28 text="{{ cmp1.state }}">28.0% IGST(28%)</option>
              <option value=18 text="{{ cmp1.state }}">18.0% IGST(18%)</option>
              <option value=12 text="{{ cmp1.state }}">12.0% IGST(12%)</option>
              <option value=5 text="{{ cmp1.state }}">05.0% IGST(05%)</option>
              <option value=3 text="{{ cmp1.state }}">03.0% IGST(03%)</option>
              <option value=0 text="{{ cmp1.state }}">0.0% IGST(0%)</option>
            </select>
          </td>
            
          <td style="width: 11%;">
            <input type="text" name='discount[]' style = "width:90px;" id="disc${roinc}" placeholder='Discount' class="form-control disc text-dark bg-light" value ="0" step="0.00" min="0"/>
          </td>
          <td style="width: 11%;">
            <input type="text" name='amount[]' id="amount${roinc}" style = "width:90px;" placeholder='Amount' class="form-control amount text-dark bg-light" step="0.00" min="0"  />
          </td>
            
          <td>
            <button type="button" id="${roinc}" class="btn btn-outline-primary clone_row text-center mb-1 p-1 " data-toggle= "tooltip" data-placement="bottom" tooltip="Clone"
                style = "width:25px; height: 25px; border-radius: 90% " >
              <i class="fa-solid fa-clone"></i>
            </button> <br>
            <button type="button" id="${roinc}" class="btn btn-outline-danger remove_row text-center p-1" data-toggle= "tooltip" data-placement="bottom" tooltip="Remove"
                style = "width:25px; height: 25px; border-radius: 90% " >
              <i class="fa fa-window-close"></i>
            </button>
          </td>
        </tr>`

     
        );
        
    });
  });

  $(document).on('click','.clone_row',function(){

    var table = document.getElementById("items-table-body");
    var roinc = table.rows.length;

    var row = $(this).closest('#items-table-body tr'); 
    var newRow = row.clone();  

    var inputs = row.find('input');
    var item = row.find('.item');
    
    var qnty = row.find('.qty');
    var rt = row.find('.rate');
    var amnt  = row.find('.amount');
    var disc = row.find(".disc");
    var intra = row.find(".tax1");
    var inter = row.find(".tax2");
    var clone = row.find(".clone_row");
    var rm = row.find(".remove_row");
    var hsn = row.find(".HSN");

    newRow.each(function(index) {
        var idPrefix = 'addr';
        var newId = idPrefix + roinc ;
        newRow.attr('id' , newId);
        
    });
    clone.each(function(index) {
        var value1 = $(this).val();
        var newId = roinc ;
        newRow.find('.clone_row').eq(index).attr('id' , newId);
        
    });
    rm.each(function(index) {
        var value1 = $(this).val();
        var newId = roinc ;
        newRow.find('.remove_row').eq(index).attr('id' , newId);
        
    });
    item.each(function(index) {
        var value1 = $(this).val();
        var idPrefix = 'item';
        var newId = idPrefix + roinc ;
        newRow.find('.item').eq(index).val(value1).attr('id' , newId);
        
    });
    qnty.each(function(index) {
        var value2 = $(this).val();
        var idPrefix = 'qty';
        var newId = idPrefix + roinc ;
        newRow.find('.qty').eq(index).val(value2).attr('id' , newId);
        
    });
    rt.each(function(index) {
        var value3 = $(this).val();
        var idPrefix = 'rate';
        var newId = idPrefix + roinc ;
        newRow.find('.rate').eq(index).val(value3).attr('id' , newId);
        
    });
    amnt.each(function(index) {
        var value4 = $(this).val();
        var idPrefix = 'amount';
        var newId = idPrefix + roinc ;
        newRow.find('.amount').eq(index).val(value4).attr('id' , newId);
        
    });

    disc.each(function(index) {
        var value5 = $(this).val();
        var idPrefix = 'disc';
        var newId = idPrefix + roinc ;
        newRow.find('.disc').eq(index).val(value5).attr('id' , newId);
        
    });
    

    intra.each(function(index){
      var value7 = $(this).val();
      var idPrefix = 'intra_tax';
      var newId = idPrefix + roinc ;
      newRow.find('.tax1').eq(index).val(value7).attr('id' , newId);
    });

    inter.each(function(index){
      var value8 = $(this).val();
      var idPrefix = 'inter_tax';
      var newId = idPrefix + roinc ;
      newRow.find('.tax2').eq(index).val(value8).attr('id' , newId);
    });

    hsn.each(function(index){
      var value9 = $(this).val();
      var idPrefix = 'HSN';
      var newId = idPrefix + roinc ;
      newRow.find('.HSN').eq(index).val(value9).attr('id' , newId);
    });

    var buttonCell = $('<td>').append(`
            <button type="button" id="${roinc}" class="btn btn-outline-primary clone_row text-center mb-1 p-1 " data-toggle= "tooltip" data-placement="bottom" tooltip="Clone"
                style = "width:25px; height: 25px; border-radius: 90% " >
              <i class="fa-solid fa-clone"></i>
            </button> <br>
            <button type="button" id="${roinc}" class="btn btn-outline-danger remove_row text-center p-1" data-toggle= "tooltip" data-placement="bottom" tooltip="Remove"
                style = "width:25px; height: 25px; border-radius: 90% " >
              <i class="fa fa-window-close"></i>
            </button>
          `);
    newRow.find('td:last-child').replaceWith(buttonCell);

    row.after(newRow);

    //recalculate after new row added

    var row_c = $("#items-table-body tr").length;
    var amount_t = 0;
    var tax = 0;
    var tax_tot = 0;
    var ship = parseFloat( $("#addcharge").val());
    for(var i=0; i<row_c;i++){
      amount_t += parseFloat($("#amount"+i).val());

      $("#subtotal").val(amount_t);
      // console.log($("#amount"+i).val())
      
      var tax1 = $("#intra_tax" +i).val();
      var tax2 = $("#inter_tax" +i).val();
      // console.log(tax1)
      // console.log(tax2)
      if (tax1 == 0){
        if(tax2 == 0){
          tax = 0;
          tax_tot += tax;
        }
        else{
          tax = (($("#qty"+i).val())*($("#rate"+i).val()))*(tax2/100) ;
          
          tax_tot += tax;
          // console.log(tax_tot);
          $("#igst").val(tax_tot);
          $("#total_taxamount").val(tax_tot);
        }
      }
      else{

        tax = (($("#qty"+i).val())*($("#rate"+i).val()))*(tax1/100) ;
        tax_tot += tax;
        $("#sgst").val(tax_tot/2);
        $("#cgst").val(tax_tot/2);
        $("#total_taxamount").val(tax_tot);
      }
      if(ship){
        $("#grandtotal").val(amount_t+tax_tot+ship)
      }
      else{
        $("#grandtotal").val(amount_t+tax_tot)
      }
    }
});

$(document).on('click','.remove_row',function(){

  var row_id = $(this).attr("id");
  $('#addr'+row_id+'').remove();

  $('tr[id^="addr"]').each(function(index) {
      var new_row_id = 'addr' + (index);
      $(this).attr('id', new_row_id);

      $(this).find('select[id^="item"]').each(function(tdIndex) {
        var new_td_id = 'item' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('input[id^="HSN"]').each(function(tdIndex) {
          var new_td_id = 'HSN' + (index * 1 + tdIndex);
          $(this).attr('id', new_td_id);
        });
     
      $(this).find('input[id^="qty"]').each(function(tdIndex) {
        var new_td_id = 'qty' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('input[id^="rate"]').each(function(tdIndex) {
        var new_td_id = 'rate' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('input[id^="disc"]').each(function(tdIndex) {
        var new_td_id = 'disc' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('input[id^="amount"]').each(function(tdIndex) {
        var new_td_id = 'amount' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('select[id^="intra_tax"]').each(function(tdIndex) {
        var new_td_id = 'intra_tax' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('select[id^="inter_tax"]').each(function(tdIndex) {
        var new_td_id = 'inter_tax' + (index * 1 + tdIndex);
        $(this).attr('id', new_td_id);
      });
      $(this).find('.clone_row').each(function(tdIndex) {
          var new_td_id = (index * 1 + tdIndex);
          $(this).attr('id', new_td_id);
        });
        $(this).find('.remove_row').each(function(tdIndex) {
          var new_td_id = (index * 1 + tdIndex);
          $(this).attr('id', new_td_id);
        });
      // $(this).find('button').each(function(tdIndex) {
      //   var new_td_id = (index * 1 + tdIndex);
      //   $(this).attr('id', new_td_id);
      // });
      // $(this).find('button[class="remove_row"]').each(function(tdIndex) {
      //   var new_td_id1 = ((index * 1) + tdIndex);
      //   $(this).attr('id', new_td_id1);
      // });
      var row_c = $("#items-table-body tr").length;
      var amount_t = 0;
      var tax = 0;
      var tax_tot = 0;
      var ship = parseFloat( $("#addcharge").val());
      for(var i=0; i<row_c;i++){
        amount_t += parseFloat($("#amount"+i).val());

        $("#subtotal").val(amount_t);

        var tax1 = $("#intra_tax" +i).val();
        var tax2 = $("#inter_tax" +i).val();

        if (tax1 == 0){
          if(tax2 == 0){
            tax = 0;
            tax_tot += tax;
          }
          else{
            tax = (($("#qty"+i).val())*($("#rate"+i).val()))*(tax2/100);
            
            tax_tot += tax;
            // console.log(tax_tot);
            $("#igst").val(tax_tot);
            $("#total_taxamount").val(tax_tot);
          }
        }
        else{

          tax = (($("#qty"+i).val())*($("#rate"+i).val()))*(tax2/100) ;
          tax_tot += tax;
          $("#sgst").val(tax_tot/2);
          $("#cgst").val(tax_tot/2);
          $("#total_taxamount").val(tax_tot);
        }
        if(ship){
          $("#grandtotal").val(amount_t+tax_tot+ship)
        }
        else{
          $("#grandtotal").val(amount_t+tax_tot)
        }
      }
  });

});

  $(document).ready(function() {
    $("#fname, #lname").change(function() {
      $("#vdisplayname").text($("#title").val() +" " + $("#fname").val() + " " + $("#lname").val());
    });
  });
  $(document).ready(function() {
    $("#cfname, #clname").change(function() {
      $("#cdisplayname").text($("#ctitle").val() +" " + $("#cfname").val() + " " + $("#clname").val());
    });
  });


  $(document).ready(function() {
    $("#v_gsttype").change(function() {
      var x=$('#v_gsttype').val();
      if(x=="unregistered Business") 
      {
        $(".gstrow").addClass('d-none');

      }
      else if(x == 'Overseas'){
        $(".gstrow").addClass('d-none');
      }
      else 
      {
        $(".gstrow").removeClass('d-none');
        $(".gstrow").addClass('d-flex');
      }
    
    });
  });


    $(document).ready(function() {
    $("#v_gstin").change(function() {

        var x=$("v_gstin").val();
        var gst_label=document.getElementById("gst_label")
        var expr=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
        if (!expr.test(x)) {
            gst_label.style.color="red";
            gst_label.innerHTML = "Invalid GST Number.";
        }
        else{
            gst_label.style.color="green";
            gst_label.innerHTML = "valid GST Number.";

        }
      });
    });

    $(document).ready(function() {
      $("#v_pan").change(function() {
        var x= $("#v_pan").val();
        var pan_label=document.getElementById("pan_label")
        var expr=    /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/
        if (!expr.test(x)) {
            pan_label.style.color="red";
            pan_label.innerHTML = "Invalid PAN Number.";
        }
        else{
            pan_label.style.color="green";
            pan_label.innerHTML = "valid PAN Number.";

        }
      });
    });

  function addressSame(){
    var chkbtn1 = document.getElementById('vokay');
    var chkbtn2 = document.getElementById('csokay');
    if (chkbtn1.checked == true) {
      document.getElementById('vsstreet').value = document.getElementById('vstreet').value;
      document.getElementById('vscity').value = document.getElementById('vcity').value;
      document.getElementById('vspincode').value = document.getElementById('vpincode').value;
      document.getElementById('vscountry').value = document.getElementById('vcountry').value;
      document.getElementById('vsstate').value = document.getElementById('vstate').value;
      document.getElementById('vsphone').value = document.getElementById('vphone').value;
      document.getElementById('vsfax').value = document.getElementById('vfax').value;
    } 
    else {
      document.getElementById('vsstreet').value = '';
      document.getElementById('vscity').value = '';
      document.getElementById('vsstate').value = '';
      document.getElementById('vspincode').value = '';
      document.getElementById('vscountry').value = '';
      document.getElementById('vsphone').value = '';
      document.getElementById('vsfax').value = '';
    }
    if (chkbtn2.checked == true) {
      document.getElementById('csstreet1').value = document.getElementById('cstreet1').value;
      document.getElementById('csstreet2').value = document.getElementById('cstreet2').value;
      document.getElementById('cscity').value = document.getElementById('ccity').value;
      document.getElementById('cspincode').value = document.getElementById('cpincode').value;
      document.getElementById('cscountry').value = document.getElementById('ccountry').value;
      document.getElementById('csstate').value = document.getElementById('cstate').value;
      document.getElementById('csphone').value = document.getElementById('cphone').value;
      document.getElementById('csfax').value = document.getElementById('cfax').value;
    } 
    else {
      document.getElementById('csstreet1').value = '';    
      document.getElementById('csstreet1').value = '';
      document.getElementById('cscity').value = '';
      document.getElementById('csstate').value = '';
      document.getElementById('cspincode').value = '';
      document.getElementById('cscountry').value = '';
      document.getElementById('csphone').value = '';
      document.getElementById('csfax').value = '';
    }
  }


  //---------modal vendor-----

$(document).on("click","#vendorSave",function(){
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_vendor' %}",

    data:{
        title : $("#title").val(),
        firstname : $("#fname").val(),
        lastname : $("#lname").val(),
        company_name : $("#vcompany").val(),
        display_name : $('#vdisplayname').text(),
        email : $("#vemail").val(),
        website :$("#wsite").val(),
        work_mobile :$("#vw_mobile").val(),
        pers_mobile :$("#vp_mobile").val(),
        skype :$("#vskype").val(),
        desg :$("#v_desg").val(),
        dpt :$("#v_dpt").val(),
        gsttype :$("#v_gsttype").val(),
        gstin :$("#v_gstin").val(),
        panno : $("#v_pan").val(),
        sourceofsupply :$("#v_srcsupply").val(),
        currency : $("#v_curn").val(),
        openingbalance : $("#v_open").val(),
        paymentterms : $("#v_terms").val(),
        street : $("#vstreet").val(),
        city : $("#vcity").val(),
        state : $("#vstate").val(),
        pincode : $("#vpincode").val(),
        fax : $("#vfax").val(),
        phone : $("#vphone").val(),
        country : $("#vcountry").val(),
        shipstreet : $("#vsstreet").val(),
        shipcity : $("#vscity").val(),
        shipstate : $("#vsstate").val(),
        shippincode : $("#vspincode").val(),
        shipcountry : $("#vscountry").val(),
        shipfax : $("#vsfax").val(),
        shipphone : $("#vsphone").val(),
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalVendor").reset();
        reloadVendor();
      },
  });        
});

function reloadVendor() {

  $.ajax({
    url: "{% url 'vendor_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#vendor');
      dropdown.empty();
      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[0]+" " +value[1] + ' ' + value[2]).val(value[3] + ' ' +value[1] + ' ' + value[2]+ ' ' +value[3]));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}



//---------modal customer-----

$(document).on("click","#customerSave",function(){

  if ($('input[name="radioCust"]:checked').val() == 'Business'){

    custType = $('#business').val();
  }
  else{
    custType = $('#individual').val();
  }
    
  if ($('input[name="radioCust1"]:checked').val() == 'Taxable'){
    cust_tax = $('#custtax1').val();
  }
  else{
      cust_tax = $('#custtax2').val();
  }
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_customer' %}",

    data:{
        customer_type : custType,
        display_name : $('#cdisplayname').text(),
        company_name : $('#ccompany').val(),
        email : $("#cemail").val(),
        work_mobile :$("#cw_mobile").val(),
        pers_mobile :$("#cp_mobile").val(),
        facebook :$("#facebook").val(),
        twitter :$("#twitter").val(),
        website :$("#website").val(),
        skype :$("#cskype").val(),
        desg :$("#c_desg").val(),
        dpt :$("#c_dpt").val(),
        gsttype :$("#c_gsttype").val(),
        placeofsupply :$("#placesupply").val(),
        tax_preference :cust_tax,
        currency : $("#c_curn").val(),
        openingbalance : $("#c_open").val(),
        paymentterms : $("#c_terms").val(),
        street1 : $("#cstreet1").val(),
        street2 : $("#cstreet2").val(),
        city : $("#ccity").val(),
        state : $("#cstate").val(),
        pincode : $("#cpincode").val(),
        fax : $("#cfax").val(),
        phone : $("#cphone").val(),
        country : $("ccountry").val(),
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalCustomer").reset();
        reloadCustomer();
      },
  });        
});

function reloadCustomer() {

  $.ajax({
    url: "{% url 'customer_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#customer');
      dropdown.empty();
      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[1]).val(value[0] + ' ' + value[1]));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

//--------payment terms modal-----------

$(document).on("click","#paySave",function(){
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_pay' %}",

    data:{
        name : $("#term_name").val(),
        days : $("#term_days").val(),
        
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalPayment").reset();
        reloadPayment();
      },
  });        
});

function reloadPayment() {

  $.ajax({
    url: "{% url 'pay_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#terms');
      dropdown.empty();
      dropdown.append(`<option value="30">NET 30</option></option>
                          
                          
                          <option value="60">NET 60</option>
                          
                         
                          <option value="recpt">Due on receipt</option>`);
      var drpv = $('#v_terms');
      drpv.empty();
      drpv.append(`<option value="30">NET 30</option>
                        
                        
                        <option value="60">NET 60</option>
                       
                        
                        <option value="recpt">Due on receipt</option>`);
      $.each(data, function(key, value) { 
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
          drpv.append($('<option></option>').attr('value', key).text(value).val(value));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}


// unit modal


$(document).on("click","#unitSave",function(){
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_unit' %}",

    data:{
        unit : $("#unit").val(),
                
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalUnit").reset();
        reloadUnit();
      },
  });        
});


function reloadUnit() {

  $.ajax({
    url: "{% url 'unit_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('#item_units');
      dropdown.empty();

      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
      });
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}


// item modal

$(document).ready(function() {

  $("#item-tax1").click(function() {
    $(".inter-intra").removeClass('d-none');
    $(".inter-intra").addClass('d-flex');
  });

  $("#item-tax2").click(function() {

    $(".inter-intra").removeClass('d-flex');
    $(".inter-intra").addClass("d-none");
  });
});


$(document).on("click","#itemSave",function(){

  if ($('input[name="radioOption"]:checked').val() == 'Goods'){

      itemtype = $('#item_type1').val();
    }
  else{
    itemtype = $('#item_type2').val();
  }

  if ($('input[name="radioOption1"]:checked').val() == 'Taxable'){
      inter_st = $('#inter').val();
      intra_st = $('#intra').val();
    }
  else{
    inter_st = 0;
    intra_st = 0;
  }
  
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_item' %}",
    
    data:{
        type : itemtype,
        name : $("#item_name").val(),
        unit : $("#item_units").val(),
        inter : inter_st,
        intra : intra_st,
        sell_price : $("#sell_price").val(),
        cost_price : $("#cost_price").val(),
        sell_acc : $("#sell_acc").val(),
        cost_acc : $("#cost_acc").val(),
        sell_desc : $("#sell_desc").val(),
        cost_desc : $("#cost_desc").val(),
        hsn : $("#HSN").val(),
        
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        // console.log(response)
        document.getElementById("modalItem").reset();
        reloadItem();
      },
  });        
});


function reloadItem() {
  $.ajax({
    url: "{% url 'item_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('.item');
      dropdown.empty();

      $.each(data, function(key, value) {
        
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
      });

    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

// account modal

$(document).on("click","#accountSave",function(){
  
  $.ajax({
    
    type : 'POST',
    url:"{% url 'recurbills_account' %}",
    
    data:{
        actype : $("#acct_type").val(),
        acname : $("#acct_name").val(),
     
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalAccount").reset();
        reloadAccount();
      },
  });        
});


function reloadAccount() {
  $.ajax({
    url: "{% url 'account_dropdown' %}",
    type: "GET",
    dataType: "json",
    data: $(this).serialize(),
    csrfmiddlewaretoken: '{{ csrf_token }}',

    success: function(data) {
      var dropdown = $('.acnt');
      dropdown.empty();
      dropdown.append(` <optgroup class=""label="Accounts Payable">
                        <option value='Accounts Payable'>Accounts Payable</option>
                      </optgroup>
  
                      <optgroup class="" label="Accounts Receivable">
                        <option value='Accounts Receivable'>Accounts Receivable</option>
                      </optgroup>

                      <optgroup class="" label="Other Current Asset">
                        <option value='Advance Tax'>Advance Tax</option>
                        <option value='Employee Advance'>Employee Advance</option>
                        <option value='Prepaid Expences'>Prepaid Expences</option>
                        <option value='GST TCS Receivable'>GST TCS Receivable</option>
                        <option value='GST TDS Receivable'>GST TDS Receivable</option>
                        <option value='Input Tax Credits'>Input Tax Credits</option>
                        <option value='Input CGST'>Input CGST</option>
                        <option value='Input IGST'>Input IGST</option>
                        <option value='Input SGST'>Input SGST</option>
                        <option value='Reverse Charge Input Tax but not Due'>Reverse Charge Input Tax but not Due</option>
                        <option value='Sales to Customers(Cash)'>Sales to Customers(Cash)</option>
                        <option value='TDS Receivable'>TDS Receivable</option>
                      </optgroup>

                      <optgroup class="" label="Expence">
                        <option value='Advertising and Marketing'>Advertising and Marketing</option>
                        <option value='Automobile Expense'>Automobile Expense</option>
                        <option value='Bad Debt'>Bad Debt</option>
                        <option value='Bank Fees and Charges'>Bank Fees and Charges</option>
                        <option value='Consultant Expense'>Consultant Expense</option>
                        <option value='Credit Card Expense'>Credit Card Expense</option>
                        <option value='IT and Internet Expenses'>IT and Internet Expenses</option>
                        <option value='Janitorial Expences'>Janitorial Expences</option>
                        <option value='Lodging'>Lodging</option>
                        <option value='Meals and Entertainment'>Meals and Entertainment</option>
                        <option value='Office Supplies'>Office Supplies</option>
                        <option value=0>Other Expenses</option>
                        <option value='Other Expenses'>Postage</option>
                        <option value='Printing and Stationery'>Printing and Stationery</option>
                        <option value='Rent Expense'>Rent Expense</option>
                        <option value='Repair and Maintenance'>Repair and Maintenance</option>
                        <option value='Salaries and Employee Wages'>Salaries and Employee Wages</option>
                        <option value='Telephone Expense'>Telephone Expense</option>
                        <option value='Travel Expense'>Travel Expense</option>
                        <option value='Uncategorized'>Uncategorized</option>
                        <option value='Contract Assets'>Contract Assets</option>
                        <option value='Depreciation and Amortisation'>Depreciation and Amortisation</option>
                        <option value='Merchandise'>Merchandise</option>
                        <option value='Raw Materials and Consumables'>Raw Materials and Consumables</option>
                        <option value='Transpotaion Expense'>Transpotaion Expense</option>
                      </optgroup>

                      <optgroup class="" label="Cost of Goods Sold">
                        <option value='Cost of Goods Sold'>Cost of Goods Sold</option>
                        <option value='Job Costing'>Job Costing</option>
                        <option value='Labor'>Labor</option>
                        <option value='Materials'>Materials</option>
                        <option value='Subcontractor'>Subcontractor</option>
                      </optgroup>

                      <optgroup class="" label="Income">
                        <option value='Discount'>Discount</option>
                        <option value='General Income'>General Income</option>
                        <option value='Interest Income'>Interest Income</option>
                        <option value='Late Fee Income'>Late Fee Income</option>
                        <option value='Other Charges'>Other Charges</option>
                        <option value='Sales'>Sales</option>
                        <option value='Shipping Charge'>Shipping Charge</option>
                      </optgroup>

                      <optgroup class="" label="Equity">
                        <option value='Drawings'>Drawings</option>
                        <option value='Opening Balance Offset'>Opening Balance Offset</option>
                        <option value="Owner's Equity">Owner's Equity</option>
                        <option value='Retained Earnings'>Retained Earnings</option>
                        <option value='Capital Stock'>Capital Stock</option>
                        <option value='Distributions'>Distributions</option>
                        <option value='Dividends Paid'>Dividends Paid</option>
                        <option value='Investments'>Investments</option>
                      </optgroup>

                      <optgroup class="" label="Other Current Liability">
                        <option value='Employee Reimbursements'>Employee Reimbursements</option>
                        <option value='Opening Balance Adjustments'>Opening Balance Adjustments</option>
                        <option value='Tax Payable'>Tax Payable</option>
                        <option value='Unearned Revenue'>Unearned Revenue</option>
                        <option value='GST Payable'>GST Payable</option>
                        <option value='Output CGST'>Output CGST</option>
                        <option value='Output IGST'>Output IGST</option>
                        <option value='Output SGST'>Output SGST</option>
                        <option value='TDS Payable'>TDS Payable</option>
                      </optgroup>

                      <optgroup class="" label="Other Expense">
                        <option value='Exchange Gain or Loss'>Exchange Gain or Loss</option>
                      </optgroup>

                      <optgroup class="" label="Fixed Asset">
                        <option value='Furniture and Equipment'>Furniture and Equipment</option>
                      </optgroup>

                      <optgroup class="" label="Stock">
                        <option value='Inventory Asset'>Inventory Asset</option>
                      </optgroup>

                      <optgroup class="" label="Cash">
                        <option value='Petty Cash'>Petty Cash</option>
                        <option value='Undeposited Funds'>Undeposited Funds</option>
                      </optgroup>

                      <optgroup class="" label="Other Liability">
                        <option value='Tag Adjustments'>Tag Adjustments</option>
                      </optgroup>

                      <optgroup class="" label="Long Term Liability">
                        <option value='Construction Loans'>Construction Loans</option>
                        <option value='Mortgages'>Mortgages</option>
                      </optgroup>
                      <optgroup class="" label="Others">`);

      $.each(data, function(key, value) {
          dropdown.append($('<option></option>').attr('value', key).text(value[0]).val(value[1]));
      });
      dropdown.append("</optgroup>");
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

  function showRate(id,name) {
    
    var n = id.slice(4);
    $.ajax({
      url: "{% url 'get_rate' %}",
      type : 'POST',
      data:{
          id : name,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
    
      success: function(response) {
        $("#rate" +n).val(response.rate);
        $("#HSN" +n).val(response.hsn);
        srcofsupply();
        itemchange();
      },
    });

  }

  $(document).on('change', '#srcofsupply',function(){

  $(".selecttax").removeClass('d-none');
  $(".selecttax").addClass('d-flex');
  var st = $("#srcofsupply").val().split(" ").slice(1).join(" ").trim();
  console.log(st)
  if( st == $("#company_state").val())
  {
    $(".tax2").removeClass('d-flex');
    $(".tax2").addClass('d-none');
    $(".tax1").removeClass('d-flex');
    $(".tax1").addClass('d-none');

    $("#cgst1").removeClass('d-none');
    $("#cgst1").addClass('d-flex');
    $("#sgst1").removeClass('d-none');
    $("#sgst1").addClass('d-flex');

    $("#igst1").removeClass('d-flex');
    $("#igst1").addClass('d-none');

  }
  else{
    $(".tax1").removeClass('d-flex');
    $(".tax1").addClass('d-none');
    $(".tax2").removeClass('d-flex');
    $(".tax2").addClass('d-none');

    $("#igst1").removeClass('d-none');
    $("#igst1").addClass('d-flex');

    $("#cgst1").removeClass('d-flex');
    $("#cgst1").addClass('d-none');
    $("#sgst1").removeClass('d-flex');
    $("#sgst1").addClass('d-none');
  }
});

$(document).on("click",".selecttax",function(){

  $(".selecttax").removeClass('d-flex');
  $(".selecttax").addClass('d-none');
  var st = $("#srcofsupply").val().split(" ").slice(1).join(" ").trim();

  if(st == $("#company_state").val()){
  $(".tax2").addClass('d-none');
  $(".tax1").removeClass('d-none');
  $(".tax1").addClass('d-flex');

  }
  else{
  $(".tax1").addClass('d-none');
  $(".tax2").removeClass('d-none');
  $(".tax2").addClass('d-flex');
  }

});


  $(document).on('change','.qty',function(){debugger

var row_count = $("#items-table-body tr").length;
var tax_tot = 0

var amount_total = 0;
var ship = parseFloat($("#addcharge").val());

for(var i=0; i<row_count;i++){
  var rate = $("#rate"+i).val();
  var qnty = $("#qty" +i).val();
  var amount = rate*qnty;
  var disc = $("#disc" + i).val();

  var tax1 = $("#intra_tax" +i).val();
  var tax2 = $("#inter_tax" +i).val();

  if (tax1 == 0){
    if(tax2 == 0){
      if (disc){
        amount_disc =  amount - disc;
        $("#amount" + i).val(amount_disc);
         
      }

      else{
        $("#amount" +i).val(amount);
       }
      tax = 0;
      tax_tot += tax;
    }
    else{
      if (disc){
        amount_disc =  amount - disc;
        $("#amount" + i).val(amount_disc);
        tax =(amount_disc*(tax2/100));
      }

      else{
        $("#amount" +i).val(amount);
        tax =(amount*(tax2/100));
       }
      
      tax_tot += tax;
      $("#igst").val(tax_tot);
      $("#total_taxamount").val(tax_tot);
    }
  }
  else{
    if (disc){
        amount_disc =  amount - disc;
        $("#amount" + i).val(amount_disc);
        tax =(amount_disc*(tax1/100));
      }

      else{
        $("#amount" +i).val(amount);
        tax =(amount*(tax1/100));
       }
    tax = (amount*(tax1/100));
    tax_tot += tax;
    $("#sgst").val(tax_tot/2);
    $("#cgst").val(tax_tot/2);
    $("#total_taxamount").val(tax_tot);
  }

  if(ship){
    // console.log('yea');
    if (disc){
      amount_disc =  amount - disc;
      $("#amount" + i).val(amount_disc);
      amount_total += amount_disc;
      $("#subtotal").val(amount_total);
      
      $("#grandtotal").val(amount_total+ ship +tax_tot);
    }

    else{
      $("#amount" +i).val(amount);
      amount_total += amount;
      $("#subtotal").val(amount_total);
      $("#grandtotal").val(amount_total+ ship +tax_tot);
    }
  }
  else{

    if (disc){
      amount_disc =  amount - disc;
      $("#amount" +i).val(amount_disc);
      amount_total += amount_disc;
      $("#subtotal").val(amount_total);
    
      $("#grandtotal").val(amount_total+tax_tot);
    }

    else{
      $("#amount" +i).val(amount);
      amount_total += amount;
      $("#subtotal").val(amount_total);
      $("#grandtotal").val(amount_total+tax_tot);
    }
  }
  
}  
});


$(document).on('change','.disc',function(){ debugger

var row_count1 = $("#items-table-body tr").length;
var amount_tot = 0;
var amount_disc,tax_tot1= 0;
var i,rate,qnty,amount;
var ship = parseFloat($("#addcharge").val());

for(i = 0;i<row_count1 ; i++){

  rate = $("#rate"+ i).val();
  qnty = $("#qty" + i).val();
  amount = rate*qnty;
  
  amount_disc =amount - $("#disc" + i).val();
  $("#amount" + i).val(amount_disc);

  amount_tot += amount_disc;

  $("#subtotal").val(amount_tot);

  var tax1 = $("#intra_tax" +i).val();
  var tax2 = $("#inter_tax" +i).val();

  if (tax1 == 0){
        if(tax2 == 0){
          tax = 0;
          tax_tot1 += tax;
        }
        else{
          tax = amount_disc*(tax2/100);
          tax_tot1 += tax;
          $("#igst").val(tax_tot1);
        }
      }
      else{
          tax = amount_disc*(tax1/100);
          tax_tot1 += tax;
          $("#sgst").val(tax_tot1/2);
          $("#cgst").val(tax_tot1/2);
          $("#total_taxamount").val(tax_tot1);
      }
  // console.log(tax)
  // console.log(tax_tot1)

  if(ship){
    $("#grandtotal").val(amount_tot+tax_tot1+ship);
  }

  else{
     $("#grandtotal").val(amount_tot+tax_tot1);
  }
}

});


$(document).on("change",".tax1",function(){

var row_count2 = $("#items-table-body tr").length;
var amount_tot1 = 0;
var ship = parseFloat($("#addcharge").val());
var tot_tax,tax_tot3 = 0;
var i;

for(i = 0;i<row_count2 ; i++){

  var rate = $("#rate"+i).val();
  var qnty = $("#qty" +i).val();
  var amount = rate*qnty;
  var disc = $("#disc" + i).val();
  var tax = $("#intra_tax"+i).val();

  if(disc){
    tot_tax = (amount-disc) * (tax/100);
  }
  else{
    tot_tax = amount * (tax/100);
  }
  
  tax_tot3 += tot_tax;

  $("#sgst").val(tax_tot3/2);
  $("#cgst").val(tax_tot3/2);
  $("#total_taxamount").val(tax_tot3);


  if(disc){
    if(ship){
      amount_disc = amount - disc;
      amount_tot1 += amount_disc
      $("#subtotal").val(amount_tot1);
      $("#grandtotal").val(amount_tot1+tax_tot3+ship);
    }
    else{
      amount_disc = amount - disc;
      amount_tot1 += amount_disc
      $("#subtotal").val(amount_tot1);
      $("#grandtotal").val(amount_tot1+tax_tot3);
    }
    
  }
  else{
    if(ship){
      amount_tot1 += amount; 
      $("#subtotal").val(amount_tot1);
      $("#grandtotal").val(amount_tot1+tax_tot3+ship);
    }
    else{
      amount_tot1 += amount; 
      $("#subtotal").val(amount_tot1);
      $("#grandtotal").val(amount_tot1+tax_tot3);
    }
  }
}

});

$(document).on("change",".tax2",function(){

var row_count2 = $("#items-table-body tr").length;
var amount_to = 0;
var tax_tot4= 0;
var ship = parseFloat($("#addcharge").val());
var i;

for(i = 0;i<row_count2 ; i++){
  console.log(i);
  var rate = $("#rate"+i).val();
  var qnty = $("#qty" +i).val();
  var amount = rate*qnty;
  var disc = $("#disc" + i).val();
  var tax = $("#inter_tax"+i).val();
  var tot
  
  if(disc){
    tot = (amount-disc) * (tax/100);
  }
  else{
    tot = amount * (tax/100);
  }

  tax_tot4 += tot

  $("#igst").val(tax_tot4);

  if(disc){
    amount_disc = amount - disc;
    amount_to += amount_disc;

    $("#subtotal").val(amount_to);
    $("#grandtotal").val(amount_to+tax_tot4);
  
  }
  else{
    amount_to += amount;
    $("#subtotal").val(amount_to);
    $("#grandtotal").val(amount_to+tax_tot4)
    
  }
}
});


    $(document).on("change","#addcharge",function(){
      var sta = $("#srcofsupply").val().split('-')[1]
      if(sta == $("#company_state").val()){
        var total =parseFloat( $("#subtotal").val())+ parseFloat( $("#sgst").val())+ parseFloat($("#cgst").val())+ parseFloat($("#addcharge").val());
        $("#grandtotal").val(total);
      }
      else if($("#srcofsupply").val() != $("#company_state").val()){
        var total = parseFloat($("#subtotal").val())+  parseFloat($("#igst").val())+ parseFloat($("#addcharge").val());
        $("#grandtotal").val(total);
      }
      else{
        var total = parseFloat($("#subtotal").val())+  parseFloat($("#addcharge").val());
        $("#grandtotal").val(total);
      }

    });

    $(document).on("change", "#add_round_off", function(){
      var round = parseFloat($("#grandtotal").val()) + parseFloat($("#add_round_off").val()) 
      $("#grandtotal").val(round);
    });


  // $(document).on("click",'#save',function(){

  //   var input1 = document.getElementById("disc");
  //   if (input1.value === "") {
  //     input1.value = 0;
  //   }
  //   var input2 = document.getElementById("date1");
  //   if (input2.value === "") {
  //     input2.value = "{% now 'Y-m-d' %}";
  //   }

  // });
  </script>

<script>
// set todays date on estimate date field
var today = new Date().toISOString().substr(0, 10);
  document.getElementById("date1").value = today;

  // Get the bill date and due date elements
  var billDateInput = document.getElementById("date1");
  var endDateInput = document.getElementById("date2");

  // Add an event listener to the payment terms select element
  var recpaymentTermsSelect = document.getElementById("terms");
  recpaymentTermsSelect.addEventListener("change", function () {
      var selectedOption = recpaymentTermsSelect.options[recpaymentTermsSelect.selectedIndex];
      var recpaymentTermsValue = selectedOption.value;

      var billDate = new Date(billDateInput.value);
      var endDate = new Date(billDate.getTime() + (recpaymentTermsValue * 24 * 60 * 60 * 1000));
      endDateInput.value = endDate.toISOString().split("T")[0];
  });


  $(document).on("click","#RepeatSave",function(){
  $.ajax({
    
    type : 'POST',
    url:"{% url 'add_repeat' %}",


    data:{
      repeats : $("#repeats_input").val(),
       
        
        csrfmiddlewaretoken: '{{ csrf_token }}'
        
      },
    
      success: function(response) {
        document.getElementById("modalRepeat").reset();
        reloadRepeat();
      },
  });        
});

$(document).ready(function(){
  reloadRepeat()
});

function reloadRepeat() {

$.ajax({
  url: "{% url 'repeat_dropdown' %}",
  type: "GET",
  dataType: "json",
  data: $(this).serialize(),
  csrfmiddlewaretoken: '{{ csrf_token }}',

  success: function(data) {
    var dropdown = $('#repeats');
    dropdown.empty();
    dropdown.append(`
               <option value="Week">Week</option>
               
               <option value="Month">Month</option>
               
               <option value="Year">Year</option>`); 
    $.each(data, function(key, value) { 
        dropdown.append('<option value="'+value[0]+'">'+value[0]+'</option>'); 
    });
    let seleted_val = '{{recur_bills.repeat_every}}'
    $('select[name="repeats"]').find('option[value="'+seleted_val+'"]').attr("selected",true);
  },
  error: function(xhr, status, error) {
  console.error(xhr.responseText);
  }
});
}

</script>

<script>

  function cancelDialog() {

      var frm = document.getElementById("forms");
      let customMsg = "Do you want to cancel?";

      if (confirm(customMsg)) {
          alert("Recurring Bill cancelled!")
      }
  }

  function saveAsDraftDialog() {
    let grand_total = $('#grandtotal').val();
    let paid = $('#amtPaid').val(); 
    if(parseFloat(paid) > parseFloat(grand_total)){
       alert("Paid amount should not be greater than grand total.")
    }
    else{
      var frm = document.getElementById("forms");
      frm.action = ("{% url 'change_draft_recurring_bills'  id=id %}")
    }
  }
function saveAndOpenDialog() {

let grand_total = $('#grandtotal').val();
let paid = $('#amtPaid').val(); 
if(parseFloat(paid) > parseFloat(grand_total)){
   alert("Paid amount should not be greater than grand total.")
}
else{
  var frm = document.getElementById("forms");
  frm.action = ("{% url 'change_recurring_bills' id=id %}")
}
  
}
</script>

  
{% endblock %}